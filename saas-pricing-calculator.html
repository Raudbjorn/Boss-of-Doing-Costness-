<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Location Database Platform - Business Calculator</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    overflow: hidden;
}

header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    text-align: center;
}

h1 {
    font-size: 28px;
    margin-bottom: 10px;
}

.subtitle {
    opacity: 0.9;
    font-size: 14px;
}

.tabs {
    display: flex;
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
}

.tab {
    flex: 1;
    padding: 15px 20px;
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    color: #6c757d;
    transition: all 0.3s;
    border-bottom: 3px solid transparent;
}

.tab:hover {
    background: #e9ecef;
}

.tab.active {
    color: #667eea;
    border-bottom-color: #667eea;
    background: white;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    padding: 30px;
}

.full-width {
    grid-column: 1 / -1;
}

.section {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

h2 {
    color: #495057;
    margin-bottom: 20px;
    font-size: 20px;
    border-bottom: 2px solid #667eea;
    padding-bottom: 10px;
}

h3 {
    color: #495057;
    margin-bottom: 15px;
    font-size: 16px;
}

.input-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 8px;
    color: #495057;
    font-weight: 500;
    font-size: 14px;
}

input[type="number"],
input[type="text"],
select {
    width: 100%;
    padding: 12px;
    border: 2px solid #dee2e6;
    border-radius: 6px;
    font-size: 16px;
    transition: border-color 0.3s;
}

input[type="number"]:focus,
input[type="text"]:focus,
select:focus {
    outline: none;
    border-color: #667eea;
}

.info-text {
    font-size: 12px;
    color: #6c757d;
    margin-top: 4px;
}

.results-grid {
    display: grid;
    gap: 15px;
}

.result-card {
    background: white;
    padding: 15px;
    border-radius: 6px;
    border-left: 4px solid #667eea;
}

.result-label {
    font-size: 13px;
    color: #6c757d;
    margin-bottom: 5px;
}

.result-value {
    font-size: 24px;
    font-weight: 700;
    color: #212529;
}

.result-subtext {
    font-size: 12px;
    color: #6c757d;
    margin-top: 4px;
}

.cost-breakdown {
    background: white;
    padding: 15px;
    border-radius: 6px;
    margin-top: 10px;
}

.breakdown-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #e9ecef;
    font-size: 14px;
}

.breakdown-row:last-child {
    border-bottom: none;
    font-weight: 700;
    font-size: 16px;
    color: #667eea;
}

.breakdown-row.total {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 2px solid #667eea;
}

.positive {
    color: #28a745;
}

.negative {
    color: #dc3545;
}

.warning {
    color: #ffc107;
}

.margin-indicator {
    padding: 15px;
    border-radius: 6px;
    margin-top: 15px;
    text-align: center;
    font-weight: 600;
}

.margin-good {
    background: #d4edda;
    color: #155724;
}

.margin-ok {
    background: #fff3cd;
    color: #856404;
}

.margin-bad {
    background: #f8d7da;
    color: #721c24;
}

@media (max-width: 768px) {
    .main-content {
        grid-template-columns: 1fr;
    }
}

.highlight-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
}

.highlight-value {
    font-size: 36px;
    font-weight: 700;
    margin: 10px 0;
}

.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.kpi-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.kpi-value {
    font-size: 32px;
    font-weight: 700;
    margin: 10px 0;
}

.kpi-label {
    font-size: 13px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.scenario-comparison {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-top: 20px;
}

.scenario-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 2px solid #dee2e6;
}

.scenario-title {
    font-weight: 700;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 2px solid #667eea;
}

.scenario-metric {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    font-size: 13px;
}

.alert-box {
    padding: 15px;
    border-radius: 6px;
    margin-top: 15px;
    border-left: 4px solid;
}

.alert-info {
    background: #d1ecf1;
    border-color: #17a2b8;
    color: #0c5460;
}

.alert-warning {
    background: #fff3cd;
    border-color: #ffc107;
    color: #856404;
}

.alert-danger {
    background: #f8d7da;
    border-color: #dc3545;
    color: #721c24;
}

.checkbox-group {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.checkbox-group input[type="checkbox"] {
    width: auto;
    margin-right: 10px;
}

.chart-placeholder {
    background: #e9ecef;
    padding: 40px;
    text-align: center;
    border-radius: 8px;
    color: #6c757d;
    font-style: italic;
}
    </style>
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Turn Your Location Library Into Predictable Recurring Revenue</h1>
            <p class="subtitle">
                Model storage, bandwidth, and pricing for film location databases ‚Äî see in seconds
                whether your platform prints money or burns cash.
            </p>
            <p class="subtitle" style="margin-top:8px;font-size:13px;opacity:0.85;">
                Built for production companies, scouts, and platforms using AWS/Supabase/Vercel-style usage pricing.
            </p>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab(event, 'calculator')">Calculator</div>
            <div class="tab" onclick="switchTab(event, 'analysis')">Business Analysis</div>
            <div class="tab" onclick="switchTab(event, 'scenarios')">Growth Scenarios</div>
            <div class="tab" onclick="switchTab(event, 'recommendations')">Recommendations</div>
            <div class="tab" onclick="switchTab(event, 'propose')">üìù PROPOSE (Grants)</div>
        </div>

        <!-- Calculator Tab -->
        <div id="calculator" class="tab-content active">
            <div class="main-content">
                <!-- Left Column: Inputs -->
                <div>
                    <div class="section">
                        <h2>Customer Segment & Usage</h2>

                        <div class="input-group">
                            <label for="customerSegment">Primary Customer Type</label>
                            <select id="customerSegment" onchange="updateSegmentDefaults()">
                                <option value="production_company">Production Company (Film/TV)</option>
                                <option value="ad_agency">Advertising Agency</option>
                                <option value="location_scout">Location Scout/Freelancer</option>
                                <option value="streaming_platform">Streaming Platform/Network</option>
                                <option value="indie_filmmaker">Independent Filmmaker</option>
                            </select>
                            <div class="info-text">Adjusts pricing and usage assumptions</div>
                        </div>

                        <div id="segmentStory" class="alert-box alert-info" style="margin-top:10px;">
                            <strong>Production Company (Film/TV)</strong><br>
                            Multi-project clients with long lead times and annual contracts. Lower churn (3%), mid-range database size.
                            Winning one production company can pay for your infrastructure for months.
                        </div>

                        <div class="input-group">
                            <label for="customers">Number of Active Clients</label>
                            <input type="number" id="customers" value="50" min="0" step="1">
                            <div class="info-text">Production companies, agencies, or individual subscribers</div>
                        </div>

                        <div class="input-group">
                            <label for="locationsPerCustomer">Locations per Client (avg)</label>
                            <input type="number" id="locationsPerCustomer" value="150" min="0" step="10">
                            <div class="info-text">Location database size per client</div>
                        </div>

                        <div class="input-group">
                            <label for="imagesPerLocation">Images per Location (avg)</label>
                            <input type="number" id="imagesPerLocation" value="25" min="0" step="1">
                            <div class="info-text">Interior/exterior shots, angles, details</div>
                        </div>

                        <div class="input-group">
                            <label for="avgImageSize">Average Image Size (MB)</label>
                            <input type="number" id="avgImageSize" value="4" min="0" step="0.5">
                            <div class="info-text">Film industry standard: 3-6 MB high-resolution</div>
                        </div>

                        <div class="input-group">
                            <label for="monthlyViewsPerImage">Monthly Views per Image (avg)</label>
                            <input type="number" id="monthlyViewsPerImage" value="5" min="0" step="1">
                            <div class="info-text">Scouting reviews, client presentations, portfolio browsing</div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Pricing & Revenue Models</h2>

                        <div class="input-group">
                            <label for="pricingModel">Pricing Model</label>
                            <select id="pricingModel" onchange="updatePricingModel()">
                                <option value="tiered" selected>Tiered Subscription (Traditional SaaS)</option>
                                <option value="usage">AWS-Style Pay-As-You-Grow</option>
                                <option value="hybrid">Hybrid (Base + Usage)</option>
                                <option value="backup">Backup/Archive (IBM Cloud Strategy)</option>
                            </select>
                            <div class="info-text">Late-market entry strategies: freemium, usage, or backup positioning</div>
                        </div>

                        <div class="alert-box alert-info" id="pricingAnchor" style="margin-top:15px;">
                            <strong>üí° Reality Check:</strong><br>
                            One day of location fees for a typical shoot runs $3‚Äì10K. One lost hard drive or corrupt location library
                            costs more than a year of your Studio tier. If you're charging less than a single day of location fees per month,
                            you're likely under-pricing the value you provide.
                        </div>

                        <div id="backupStrategyInfo" style="display: none; background: #fff3e0; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #ff9800;">
                            <strong>üíæ Backup/Archive Strategy (IBM Cloud Approach)</strong><br>
                            <span style="font-size: 13px; color: #555;">
                                <strong>Target: Customers already using competitors</strong> (Photoshelter, Widen, SmugMug Pro)<br>
                                IBM offered free ingress/egress to become "backup cloud" - we do similar:<br>
                                <br>
                                <strong>Phase 1 - Foot in the Door:</strong><br>
                                ‚Ä¢ <strong>Free unlimited migration</strong> from any competitor<br>
                                ‚Ä¢ <strong>Free ongoing sync API</strong> - mirror their primary system<br>
                                ‚Ä¢ <strong>50% discount "Archive tier"</strong> - disaster recovery positioning<br>
                                ‚Ä¢ <strong>Zero lock-in</strong> - free unlimited export, all metadata<br>
                                <br>
                                <strong>Phase 2 - Demonstrate Value:</strong><br>
                                ‚Ä¢ Film-specific features their current system lacks<br>
                                ‚Ä¢ Faster search, better metadata, production workflows<br>
                                ‚Ä¢ Side-by-side usage reveals our superiority<br>
                                <br>
                                <strong>Phase 3 - Role Reversal:</strong><br>
                                ‚Ä¢ We become primary (6-12 months), they become archive<br>
                                ‚Ä¢ Upgrade to full price once we're the primary system<br>
                                <br>
                                <em>Calculator models 50% discount for archive positioning</em>
                            </span>
                        </div>

                        <div id="tieredPricingSection">
                            <div class="input-group">
                                <label for="pricingTier">Pricing Tier</label>
                                <select id="pricingTier" onchange="updatePricingTier()">
                                    <option value="custom">Custom Pricing</option>
                                    <option value="free">Free Tier (Always Free)</option>
                                    <option value="starter">Starter ($29/month)</option>
                                    <option value="freelancer">Freelancer ($149/month)</option>
                                    <option value="professional" selected>Professional ($499/month)</option>
                                    <option value="studio">Studio ($1,499/month)</option>
                                    <option value="enterprise">Enterprise ($3,999/month)</option>
                                </select>
                                <div class="info-text">Fixed monthly subscription tiers (AWS-style free tier available)</div>
                            </div>

                            <div id="freemiumSection" style="display: none; background: #e8f9f0; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #28a745;">
                                <strong>üéÅ Free Tier Strategy (AWS-style)</strong><br>
                                <span style="font-size: 13px; color: #555;">
                                    Like AWS Free Tier - get users hooked, convert to paid:<br>
                                    ‚Ä¢ <strong>Limits:</strong> 25 locations, 10 images each, 1GB storage<br>
                                    ‚Ä¢ <strong>Perfect for:</strong> Film students, indie shorts, testing platform<br>
                                    ‚Ä¢ <strong>Conversion goal:</strong> 2-5% to paid tiers within 90 days<br>
                                    ‚Ä¢ <strong>Cost per free user:</strong> ~$0.50-2/month infrastructure
                                </span>
                            </div>

                            <div id="starterSection" style="display: none; background: #fff3cd; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #ffc107;">
                                <strong>üöÄ Starter Tier (Like Lightsail)</strong><br>
                                <span style="font-size: 13px; color: #555;">
                                    Ultra-simple, ultra-cheap entry point:<br>
                                    ‚Ä¢ <strong>$29/month flat</strong> - no surprises, no overages<br>
                                    ‚Ä¢ <strong>Limits:</strong> 50 locations, 15 images each, 5GB storage<br>
                                    ‚Ä¢ <strong>Perfect for:</strong> Solo location scouts, small indie films<br>
                                    ‚Ä¢ <strong>Value prop:</strong> Coffee shop price for professional tool
                                </span>
                            </div>
                        </div>

                        <div id="usagePricingInfo" style="display: none; background: #e8f4f8; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #2196F3;">
                            <strong>üí° AWS-Style Usage-Based Pricing</strong><br>
                            <span style="font-size: 13px; color: #555;">
                                Like AWS revolutionized infrastructure: pay only for what you use.<br>
                                ‚Ä¢ <strong>Storage:</strong> $0.08/GB/month (raw AWS S3: ~$0.023/GB)<br>
                                ‚Ä¢ <strong>Bandwidth:</strong> $0.12/GB (raw AWS CloudFront: ~$0.085/GB)<br>
                                ‚Ä¢ <strong>Base platform fee:</strong> $99/month (platform access, search UI, collaboration tools, support)<br>
                                <span style="color: #1976d2; font-size: 12px; display: block; margin-top: 8px;">
                                    <em>Note: Our pricing includes managed services, security, metadata management, collaboration features, and support‚Äînot just raw storage/bandwidth like AWS infrastructure.</em>
                                </span>
                                <em style="display: block; margin-top: 8px;">Perfect for projects with variable intensity (heavy pre-production, quiet during shooting)</em>
                            </span>
                        </div>

                        <div class="input-group">
                            <label for="pricePerCustomer">Price per Client per Month ($)</label>
                            <input type="number" id="pricePerCustomer" value="499" min="0" step="10">
                            <div class="info-text">Average subscription price across all clients</div>
                        </div>

                        <div class="input-group">
                            <label for="setupFee">Onboarding/Setup Fee ($)</label>
                            <input type="number" id="setupFee" value="500" min="0" step="50">
                            <div class="info-text">One-time fee for data migration, training, customization</div>
                        </div>

                        <div class="input-group">
                            <label for="projectFeeRevenue">Monthly Project-Based Revenue ($)</label>
                            <input type="number" id="projectFeeRevenue" value="0" min="0" step="100">
                            <div class="info-text">Additional revenue from freelancer/single-project access</div>
                        </div>

                        <div class="input-group">
                            <label for="monthlyChurn">Monthly Churn Rate (%)</label>
                            <input type="number" id="monthlyChurn" value="3" min="0" max="100" step="0.5">
                            <div class="info-text">Film industry typically has lower churn (long contracts)</div>
                        </div>

                        <div class="input-group">
                            <label for="monthlyGrowth">Monthly Growth Rate (%)</label>
                            <input type="number" id="monthlyGrowth" value="8" min="0" max="1000" step="1">
                            <div class="info-text">New client acquisition rate</div>
                        </div>
                    </div>

                    <div class="section" id="freemiumMetrics" style="display: none;">
                        <h2>Freemium Strategy Metrics</h2>

                        <div class="input-group">
                            <label for="freeUsers">Number of Free Tier Users</label>
                            <input type="number" id="freeUsers" value="500" min="0" step="50">
                            <div class="info-text">Film students, indie filmmakers, trial users</div>
                        </div>

                        <div class="input-group">
                            <label for="conversionRate">Free ‚Üí Paid Conversion Rate (%)</label>
                            <input type="number" id="conversionRate" value="3" min="0" max="100" step="0.5">
                            <div class="info-text">AWS achieves 2-5% after 90 days; SaaS average 2-4%</div>
                        </div>

                        <div class="input-group">
                            <label for="avgConversionTime">Avg Days to Convert</label>
                            <input type="number" id="avgConversionTime" value="60" min="0" max="365" step="10">
                            <div class="info-text">How long before free users upgrade</div>
                        </div>

                        <div class="input-group">
                            <label for="costPerFreeUser">Cost per Free User ($/month)</label>
                            <input type="number" id="costPerFreeUser" value="1.5" min="0" max="10" step="0.5">
                            <div class="info-text">Infrastructure, support, bandwidth for free tier</div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Hosting & Infrastructure</h2>

                        <div class="checkbox-group">
                            <input type="checkbox" id="useVercel" checked>
                            <label for="useVercel" style="margin-bottom: 0;">Use Vercel for Frontend Hosting</label>
                        </div>

                        <div class="input-group">
                            <label for="vercelTeamMembers">Vercel Team Members</label>
                            <input type="number" id="vercelTeamMembers" value="1" min="1" step="1">
                            <div class="info-text">$20/month per seat</div>
                        </div>

                        <div class="input-group">
                            <label for="vercelBandwidthMultiplier">Frontend Bandwidth Multiplier</label>
                            <input type="number" id="vercelBandwidthMultiplier" value="0.3" min="0" max="1" step="0.05">
                            <div class="info-text">% of image bandwidth for frontend assets (0.3 = 30%)</div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Additional Costs</h2>

                        <div class="input-group">
                            <label for="employeeSalaries">Monthly Team Costs ($)</label>
                            <input type="number" id="employeeSalaries" value="15000" min="0" step="1000">
                            <div class="info-text">Developers, customer success, location curators</div>
                        </div>

                        <div class="input-group">
                            <label for="marketingSpend">Monthly Sales & Marketing ($)</label>
                            <input type="number" id="marketingSpend" value="3000" min="0" step="500">
                            <div class="info-text">Film festival presence, trade shows, partnerships</div>
                        </div>

                        <div class="input-group">
                            <label for="otherMonthlyCosts">Other Operating Costs ($)</label>
                            <input type="number" id="otherMonthlyCosts" value="500" min="0" step="100">
                            <div class="info-text">Legal (contracts/licensing), insurance, tools</div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Results -->
                <div>
                    <div class="section">
                        <h2>Storage & Bandwidth</h2>

                        <div class="results-grid">
                            <div class="result-card">
                                <div class="result-label">Total Storage Required</div>
                                <div class="result-value" id="totalStorage">0 GB</div>
                                <div class="result-subtext" id="totalImages">0 images total</div>
                            </div>

                            <div class="result-card">
                                <div class="result-label">Monthly Bandwidth (Images)</div>
                                <div class="result-value" id="totalEgress">0 GB</div>
                                <div class="result-subtext" id="egressInfo">Supabase bandwidth</div>
                            </div>

                            <div class="result-card">
                                <div class="result-label">Frontend Bandwidth</div>
                                <div class="result-value" id="vercelBandwidth">0 GB</div>
                                <div class="result-subtext">Vercel bandwidth</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Cost Breakdown</h2>
                        <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                            ‚òÅÔ∏è <strong>AWS-Style Infrastructure:</strong> Like AWS S3 + CloudFront, you pay a base fee + usage overages.
                            Costs scale automatically with your location library size and scouting activity.
                        </p>

                        <div class="cost-breakdown">
                            <h3>Supabase Costs (Storage & Bandwidth)</h3>
                            <div class="breakdown-row">
                                <span>Pro Plan Base</span>
                                <span>$<span id="baseCost">120.00</span></span>
                            </div>
                            <div class="breakdown-row">
                                <span>Storage Overage (<span id="storageOverage">0</span> GB @ $0.021/GB)</span>
                                <span>$<span id="storageCost">0.00</span></span>
                            </div>
                            <div class="breakdown-row">
                                <span>Bandwidth Overage (<span id="egressOverage">0</span> GB @ $0.09/GB)</span>
                                <span>$<span id="egressCost">0.00</span></span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Supabase Total</span>
                                <span>$<span id="supabaseTotalCost">120.00</span></span>
                            </div>
                        </div>

                        <div class="cost-breakdown">
                            <h3>Vercel Costs (Frontend Hosting)</h3>
                            <div class="breakdown-row">
                                <span>Pro Plan (<span id="vercelSeats">1</span> seats @ $20/seat)</span>
                                <span>$<span id="vercelBaseCost">20.00</span></span>
                            </div>
                            <div class="breakdown-row">
                                <span>Bandwidth Overage (<span id="vercelBandwidthOverage">0</span> GB @ $0.15/GB)</span>
                                <span>$<span id="vercelBandwidthCost">0.00</span></span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Vercel Total</span>
                                <span>$<span id="vercelTotalCost">20.00</span></span>
                            </div>
                        </div>

                        <div class="cost-breakdown">
                            <h3>Other Costs</h3>
                            <div class="breakdown-row">
                                <span>Salaries/Contractors</span>
                                <span>$<span id="salariesDisplay">0.00</span></span>
                            </div>
                            <div class="breakdown-row">
                                <span>Marketing</span>
                                <span>$<span id="marketingDisplay">0.00</span></span>
                            </div>
                            <div class="breakdown-row">
                                <span>Other</span>
                                <span>$<span id="otherCosts">0.00</span></span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Other Total</span>
                                <span>$<span id="otherTotalCost">0.00</span></span>
                            </div>
                        </div>

                        <div class="cost-breakdown">
                            <div class="breakdown-row total">
                                <span style="font-size: 18px;">TOTAL MONTHLY COSTS</span>
                                <span style="font-size: 18px;">$<span id="totalCosts">140.00</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Revenue & Profitability</h2>

                        <div class="highlight-box">
                            <div class="result-label" style="color: rgba(255,255,255,0.9);">Monthly Recurring Revenue (MRR)</div>
                            <div class="highlight-value">$<span id="monthlyRevenue">0</span></div>
                            <div class="result-subtext" style="color: rgba(255,255,255,0.8);"><span id="customerCount">0</span> customers √ó $<span id="priceDisplay">0</span>/mo</div>
                        </div>

                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <div class="kpi-label">Net Profit</div>
                                <div class="kpi-value" id="netProfit">$0</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-label">Profit Margin</div>
                                <div class="kpi-value" id="profitMargin">0%</div>
                            </div>
                        </div>

                        <div id="marginIndicator" class="margin-indicator"></div>

                        <div class="cost-breakdown">
                            <h3>Per Customer Economics</h3>
                            <div class="breakdown-row">
                                <span>Revenue per Customer</span>
                                <span>$<span id="revenuePerCustomer">0.00</span></span>
                            </div>
                            <div class="breakdown-row">
                                <span>Cost per Customer</span>
                                <span>$<span id="costPerCustomer">0.00</span></span>
                            </div>
                            <div class="breakdown-row">
                                <span>Profit per Customer</span>
                                <span id="profitPerCustomerValue">$<span id="profitPerCustomer">0.00</span></span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Unit Economics Ratio</span>
                                <span id="unitEconomics">0.0x</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Business Analysis Tab -->
        <div id="analysis" class="tab-content">
            <div class="main-content">
                <div class="section full-width">
                    <h2>Key Business Metrics</h2>
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-label">Annual Recurring Revenue</div>
                            <div class="kpi-value positive">$<span id="arr">0</span></div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Customer Lifetime Value</div>
                            <div class="kpi-value">$<span id="ltv">0</span></div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">CAC Payback (months)</div>
                            <div class="kpi-value" id="cacPayback">N/A</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">LTV:CAC Ratio</div>
                            <div class="kpi-value" id="ltvCacRatio">N/A</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Gross Margin</div>
                            <div class="kpi-value" id="grossMargin">0%</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Burn Rate</div>
                            <div class="kpi-value" id="burnRate">$0</div>
                        </div>
                    </div>
                </div>

                <div class="section full-width">
                    <h2>12-Month Financial Projection</h2>
                    <div class="cost-breakdown">
                        <div class="breakdown-row">
                            <span>Starting Customers</span>
                            <span id="projStartCustomers">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span>Projected Customers (Month 12)</span>
                            <span id="projEndCustomers">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span>Total New Customers Acquired</span>
                            <span id="projNewCustomers">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span>Total Customer Churn</span>
                            <span id="projChurnedCustomers">0</span>
                        </div>
                        <div class="breakdown-row total">
                            <span>Total 12-Month Revenue</span>
                            <span>$<span id="projRevenue">0</span></span>
                        </div>
                        <div class="breakdown-row">
                            <span>Total 12-Month Costs</span>
                            <span>$<span id="projCosts">0</span></span>
                        </div>
                        <div class="breakdown-row total">
                            <span>12-Month Net Profit/Loss</span>
                            <span id="projProfit">$0</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Cost Structure Analysis</h2>
                    <div class="cost-breakdown">
                        <h3>Fixed vs Variable Costs</h3>
                        <div class="breakdown-row">
                            <span>Fixed Costs (Base fees, salaries)</span>
                            <span>$<span id="fixedCosts">0</span>/mo</span>
                        </div>
                        <div class="breakdown-row">
                            <span>Variable Costs (Usage-based)</span>
                            <span>$<span id="variableCosts">0</span>/mo</span>
                        </div>
                        <div class="breakdown-row total">
                            <span>Variable Cost Ratio</span>
                            <span id="variableCostRatio">0%</span>
                        </div>
                    </div>

                    <div class="cost-breakdown">
                        <h3>Infrastructure Efficiency</h3>
                        <div class="breakdown-row">
                            <span>Cost per GB Storage</span>
                            <span>$<span id="costPerGBStorage">0.00</span></span>
                        </div>
                        <div class="breakdown-row">
                            <span>Cost per GB Bandwidth</span>
                            <span>$<span id="costPerGBBandwidth">0.00</span></span>
                        </div>
                        <div class="breakdown-row">
                            <span>Storage Utilization</span>
                            <span id="storageUtilization">0%</span>
                        </div>
                        <div class="breakdown-row">
                            <span>Bandwidth Utilization</span>
                            <span id="bandwidthUtilization">0%</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Scaling Analysis</h2>
                    <div class="cost-breakdown">
                        <h3>Break-even Analysis</h3>
                        <div class="breakdown-row">
                            <span>Current Status</span>
                            <span id="breakEvenStatus">-</span>
                        </div>
                        <div class="breakdown-row">
                            <span>Customers Needed to Break Even</span>
                            <span id="breakEvenCustomers">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span>MRR Needed to Break Even</span>
                            <span>$<span id="breakEvenMRR">0</span></span>
                        </div>
                        <div class="breakdown-row total">
                            <span>Months to Break Even</span>
                            <span id="monthsToBreakEven">N/A</span>
                        </div>
                    </div>

                    <div id="scalingAlert" class="alert-box"></div>
                </div>
            </div>
        </div>

        <!-- Scenarios Tab -->
        <div id="scenarios" class="tab-content">
            <div class="main-content">
                <div class="section full-width">
                    <h2>Growth Scenario Comparison</h2>
                    <div class="scenario-comparison">
                        <div class="scenario-card">
                            <div class="scenario-title">Conservative Growth</div>
                            <div class="scenario-metric">
                                <span>Customers (12mo):</span>
                                <strong id="scenario1Customers">0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Revenue:</span>
                                <strong>$<span id="scenario1Revenue">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Costs:</span>
                                <strong>$<span id="scenario1Costs">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Profit:</span>
                                <strong id="scenario1Profit">$0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Margin:</span>
                                <strong id="scenario1Margin">0%</strong>
                            </div>
                        </div>

                        <div class="scenario-card" style="border-color: #667eea;">
                            <div class="scenario-title" style="color: #667eea;">Current Trajectory</div>
                            <div class="scenario-metric">
                                <span>Customers (12mo):</span>
                                <strong id="scenario2Customers">0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Revenue:</span>
                                <strong>$<span id="scenario2Revenue">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Costs:</span>
                                <strong>$<span id="scenario2Costs">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Profit:</span>
                                <strong id="scenario2Profit">$0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Margin:</span>
                                <strong id="scenario2Margin">0%</strong>
                            </div>
                        </div>

                        <div class="scenario-card">
                            <div class="scenario-title">Aggressive Growth</div>
                            <div class="scenario-metric">
                                <span>Customers (12mo):</span>
                                <strong id="scenario3Customers">0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Revenue:</span>
                                <strong>$<span id="scenario3Revenue">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Costs:</span>
                                <strong>$<span id="scenario3Costs">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Profit:</span>
                                <strong id="scenario3Profit">$0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Margin:</span>
                                <strong id="scenario3Margin">0%</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section full-width">
                    <h2>Pricing Strategy Analysis</h2>
                    <div class="scenario-comparison">
                        <div class="scenario-card">
                            <div class="scenario-title">Budget Tier ($29/mo)</div>
                            <div class="scenario-metric">
                                <span>Monthly Revenue:</span>
                                <strong>$<span id="pricing1Revenue">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Profit:</span>
                                <strong id="pricing1Profit">$0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Margin:</span>
                                <strong id="pricing1Margin">0%</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Break-even:</span>
                                <strong id="pricing1BreakEven">0</strong> customers
                            </div>
                        </div>

                        <div class="scenario-card" style="border-color: #667eea;">
                            <div class="scenario-title" style="color: #667eea;">Current Pricing</div>
                            <div class="scenario-metric">
                                <span>Monthly Revenue:</span>
                                <strong>$<span id="pricing2Revenue">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Profit:</span>
                                <strong id="pricing2Profit">$0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Margin:</span>
                                <strong id="pricing2Margin">0%</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Break-even:</span>
                                <strong id="pricing2BreakEven">0</strong> customers
                            </div>
                        </div>

                        <div class="scenario-card">
                            <div class="scenario-title">Premium Tier ($99/mo)</div>
                            <div class="scenario-metric">
                                <span>Monthly Revenue:</span>
                                <strong>$<span id="pricing3Revenue">0</span></strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Monthly Profit:</span>
                                <strong id="pricing3Profit">$0</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Margin:</span>
                                <strong id="pricing3Margin">0%</strong>
                            </div>
                            <div class="scenario-metric">
                                <span>Break-even:</span>
                                <strong id="pricing3BreakEven">0</strong> customers
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommendations Tab -->
        <div id="recommendations" class="tab-content">
            <div class="main-content">
                <div class="section full-width">
                    <h2>Business Classification</h2>
                    <div id="businessClassification" class="highlight-box" style="text-align: left; padding: 20px;">
                        <div style="font-size: 16px; margin-bottom: 10px;">You are building:</div>
                        <div id="classificationText" style="font-size: 18px; font-weight: 600; line-height: 1.5;"></div>
                    </div>
                </div>

                <div class="section full-width">
                    <h2>Investor One-Liner</h2>
                    <div class="alert-box alert-info">
                        <p id="investorOneLiner" style="font-style:italic;font-size:15px;line-height:1.6;margin:0;"></p>
                    </div>
                </div>

                <div class="section full-width">
                    <h2>Business Health Assessment</h2>
                    <div id="healthMetrics"></div>
                </div>

                <div class="section full-width">
                    <h2>Strategic Recommendations</h2>
                    <div id="recommendations-content"></div>
                </div>

                <div class="section full-width">
                    <h2>Cost Optimization Opportunities</h2>
                    <div id="optimization-content"></div>
                </div>

                <div class="section full-width">
                    <h2>Risk Assessment</h2>
                    <div id="risk-content"></div>
                </div>
            </div>
        </div>

        <!-- PROPOSE Tab (Grant Applications) -->
        <div id="propose" class="tab-content">
            <div class="main-content">
                <!-- Header Section -->
                <div class="section full-width" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 30px;">
                    <h2 style="color: white; margin-bottom: 15px;">üìù PROPOSE: Rann√≠s Grant Application Generator</h2>
                    <p style="opacity: 0.95; font-size: 14px;">
                        Prepare professional grant applications for T√¶kni√ær√≥unarsj√≥√∞ur (Icelandic Technology Development Fund).
                        Export budgets to Excel, compare programs, generate progress reports, and project multi-year financials.
                    </p>
                </div>

                <!-- Program Selection & Comparison -->
                <div class="section full-width">
                    <h2>1. Compare Grant Programs</h2>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                        <!-- V√∂xtur (Growth) -->
                        <div style="border: 2px solid #10b981; border-radius: 8px; padding: 20px; cursor: pointer;"
                             onclick="selectGrantProgram('voxtur')" id="program-voxtur">
                            <div style="font-size: 24px; margin-bottom: 10px;">üöÄ</div>
                            <h3 style="color: #10b981; margin-bottom: 10px;">V√∂xtur (Growth)</h3>
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 15px;">
                                For companies with proven business model seeking scaling capital
                            </div>
                            <div style="background: #f0fdf4; padding: 15px; border-radius: 6px; margin-bottom: 10px;">
                                <div style="margin-bottom: 8px;"><strong>Max Grant:</strong> 50M ISK</div>
                                <div style="margin-bottom: 8px;"><strong>Min Own Contribution:</strong> 25%</div>
                                <div style="margin-bottom: 8px;"><strong>Duration:</strong> 12-36 months</div>
                                <div><strong>Evaluation:</strong> Innovation (30%), Impact (40%), Execution (30%)</div>
                            </div>
                            <div style="font-size: 12px; color: #6c757d;">
                                ‚úì Proven product-market fit<br>
                                ‚úì Ready to scale operations<br>
                                ‚úì Clear growth strategy
                            </div>
                        </div>

                        <!-- Sproti (Sprout) -->
                        <div style="border: 2px solid #6366f1; border-radius: 8px; padding: 20px; cursor: pointer;"
                             onclick="selectGrantProgram('sproti')" id="program-sproti">
                            <div style="font-size: 24px; margin-bottom: 10px;">üå±</div>
                            <h3 style="color: #6366f1; margin-bottom: 10px;">Sproti (Sprout)</h3>
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 15px;">
                                Three-phase program for early-stage startups
                            </div>
                            <div style="background: #eef2ff; padding: 15px; border-radius: 6px; margin-bottom: 10px;">
                                <div style="margin-bottom: 8px;"><strong>Max Grant:</strong> 15M ISK</div>
                                <div style="margin-bottom: 8px;"><strong>Min Own Contribution:</strong> 10%</div>
                                <div style="margin-bottom: 8px;"><strong>Duration:</strong> 12-24 months</div>
                                <div><strong>Evaluation:</strong> Innovation (40%), Impact (30%), Execution (30%)</div>
                            </div>
                            <div style="font-size: 12px; color: #6c757d;">
                                ‚úì Early-stage development<br>
                                ‚úì Three-phase funding<br>
                                ‚úì Milestone-based progression
                            </div>
                        </div>

                        <!-- √ûr√≥unarfr√¶ (Development Seed) -->
                        <div style="border: 2px solid #f59e0b; border-radius: 8px; padding: 20px; cursor: pointer;"
                             onclick="selectGrantProgram('throunarfrae')" id="program-throunarfrae">
                            <div style="font-size: 24px; margin-bottom: 10px;">üí°</div>
                            <h3 style="color: #f59e0b; margin-bottom: 10px;">√ûr√≥unarfr√¶ (Dev Seed)</h3>
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 15px;">
                                For R&D and product development projects
                            </div>
                            <div style="background: #fffbeb; padding: 15px; border-radius: 6px; margin-bottom: 10px;">
                                <div style="margin-bottom: 8px;"><strong>Max Grant:</strong> 25M ISK</div>
                                <div style="margin-bottom: 8px;"><strong>Min Own Contribution:</strong> 40%</div>
                                <div style="margin-bottom: 8px;"><strong>Duration:</strong> 12-24 months</div>
                                <div><strong>Evaluation:</strong> Innovation (35%), Impact (35%), Execution (30%)</div>
                            </div>
                            <div style="font-size: 12px; color: #6c757d;">
                                ‚úì R&D focus<br>
                                ‚úì Technical innovation<br>
                                ‚úì Development feasibility
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project Configuration -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="section">
                        <h2>2. Project Configuration</h2>

                        <div class="input-group">
                            <label for="grantProgram">Selected Program</label>
                            <select id="grantProgram" onchange="calculateGrant()">
                                <option value="voxtur">V√∂xtur (Growth)</option>
                                <option value="sproti">Sproti (Sprout)</option>
                                <option value="throunarfrae">√ûr√≥unarfr√¶ (Development Seed)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="projectName">Project Name</label>
                            <input type="text" id="projectName" value="Film Location Database Platform" onchange="calculateGrant()">
                        </div>

                        <div class="input-group">
                            <label for="projectDuration">Project Duration (months)</label>
                            <input type="number" id="projectDuration" value="24" min="12" max="36" step="1" onchange="calculateGrant()">
                            <div class="info-text">Grant period: 12-36 months</div>
                        </div>

                        <div class="input-group">
                            <label for="grantRequestPercent">Grant Request (%)</label>
                            <input type="range" id="grantRequestPercent" value="60" min="10" max="90" step="5" onchange="updateGrantPercentage()">
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span style="font-size: 12px;">10%</span>
                                <span id="grantPercentDisplay" style="font-weight: 600; color: #10b981;">60%</span>
                                <span style="font-size: 12px;">90%</span>
                            </div>
                            <div class="info-text" id="grantPercentWarning"></div>
                        </div>

                        <div class="input-group">
                            <label for="companyName">Company/Organization</label>
                            <input type="text" id="companyName" value="" placeholder="Your company name" onchange="calculateGrant()">
                        </div>

                        <div class="input-group">
                            <label for="contactPerson">Project Manager</label>
                            <input type="text" id="contactPerson" value="" placeholder="Your name" onchange="calculateGrant()">
                        </div>
                    </div>

                    <!-- Budget Overview -->
                    <div class="section">
                        <h2>3. Budget Overview</h2>
                        <div id="grantBudgetSummary"></div>

                        <div style="margin-top: 20px;">
                            <button onclick="exportGrantBudgetExcel()" style="width: 100%; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                üìä Export Budget to Excel (Rann√≠s Format)
                            </button>
                            <button onclick="exportProgressReport()" style="width: 100%; padding: 12px; background: #6366f1; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                                üìã Generate Progress Report
                            </button>
                            <button onclick="exportApplicationPDF()" style="width: 100%; padding: 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                üìÑ Export Application (Markdown)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Multi-Year Projections -->
                <div class="section full-width">
                    <h2>4. Multi-Year Financial Projections</h2>
                    <div style="margin-bottom: 15px;">
                        <label style="display: inline-flex; align-items: center;">
                            <input type="checkbox" id="includePostGrant" checked onchange="calculateGrant()" style="margin-right: 8px;">
                            <span>Include 2 years post-grant projections</span>
                        </label>
                    </div>
                    <div id="multiYearProjections"></div>
                </div>

                <!-- Progress Tracking (for awarded grants) -->
                <div class="section full-width">
                    <h2>5. Progress Tracking (Post-Award)</h2>
                    <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; border-left: 4px solid #10b981;">
                        <p style="margin-bottom: 15px; color: #065f46;">
                            Once your grant is awarded, use this section to track actual vs projected costs and generate progress reports for Rann√≠s.
                        </p>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                            <div>
                                <label style="font-weight: 600; margin-bottom: 8px; display: block;">Reporting Period</label>
                                <select id="reportingPeriod" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                                    <option value="6">First 6 months (Mid-project)</option>
                                    <option value="12">Year 1 Complete</option>
                                    <option value="18">18 months (Year 2 Mid-project)</option>
                                    <option value="24">Year 2 Complete</option>
                                    <option value="final">Final Report</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-weight: 600; margin-bottom: 8px; display: block;">Actual Costs to Date (ISK)</label>
                                <input type="number" id="actualCostsToDate" value="0" min="0" step="100000" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                            </div>
                        </div>

                        <div id="progressTrackingSummary" style="margin-top: 20px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// Constants
const SUPABASE_PRO_BASE = 120;
const STORAGE_INCLUDED = 100;
const STORAGE_COST_PER_GB = 0.021;
const EGRESS_INCLUDED = 250;
const EGRESS_COST_PER_GB = 0.09;

const VERCEL_PRO_PER_SEAT = 20;
const VERCEL_BANDWIDTH_INCLUDED = 1000; // 1TB = 1000GB
const VERCEL_BANDWIDTH_COST = 0.15;

// Usage-based pricing (AWS-style)
const USAGE_BASE_FEE = 99; // Monthly platform access fee per customer
const USAGE_STORAGE_PER_GB = 0.08; // Per GB/month storage (applied to aggregate total storage across all customers)
const USAGE_BANDWIDTH_PER_GB = 0.12; // Per GB bandwidth (applied to aggregate total bandwidth across all customers)

// Pricing tiers
const TIER_FREE = 0; // Always free tier
const TIER_STARTER = 29; // Like Lightsail - ultra-cheap entry
const TIER_FREELANCER = 149;
const TIER_PROFESSIONAL = 499;
const TIER_STUDIO = 1499;
const TIER_ENTERPRISE = 3999;

// Number formatters
const money = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    maximumFractionDigits: 0
});

const moneyDecimal = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
});

const integer = new Intl.NumberFormat('en-US', {
    maximumFractionDigits: 0
});

// Customer segment stories
const segmentStories = {
    production_company: `
        <strong>Production Company (Film/TV)</strong><br>
        Multi-project clients with long lead times and annual contracts. Lower churn (3%), mid-range database size.
        Winning one production company can pay for your infrastructure for months.
    `,
    ad_agency: `
        <strong>Advertising Agency</strong><br>
        High-volume users with frequent campaigns and many client presentations. Larger databases (300+ locations),
        higher viewing activity. Premium pricing justified by agency margins and client billing pass-through.
    `,
    location_scout: `
        <strong>Location Scout/Freelancer</strong><br>
        Largest databases (500+ locations) but lower ARPU. Higher churn (8%) as they work project-to-project.
        Volume play: many scouts paying modest fees adds up. Great candidates for Freelancer tier.
    `,
    streaming_platform: `
        <strong>Streaming Platform/Network</strong><br>
        Fewer customers, but massive contracts. Lowest churn (2%), highest LTV. One streaming platform client
        can fund your entire operation. Focus on white-glove service and enterprise features.
    `,
    indie_filmmaker: `
        <strong>Independent Filmmaker</strong><br>
        Smallest databases, lowest pricing tier, highest churn (10%). Great for freemium conversion funnel:
        get them hooked during pre-production, convert when they see the value. Gateway to bigger projects.
    `
};

// Business classification generator
function classifyBusiness(metrics) {
    const {
        infrastructureCosts, totalCosts, monthlyChurn, pricePerCustomer,
        profitMargin, grossMargin
    } = metrics;

    let classifications = [];

    // Infrastructure intensity
    const infraRatio = infrastructureCosts / totalCosts;
    if (infraRatio > 0.3) {
        classifications.push('infrastructure-heavy');
    } else if (infraRatio > 0.15) {
        classifications.push('balanced infrastructure');
    } else {
        classifications.push('people-heavy');
    }

    // Margin quality
    if (profitMargin >= 50) {
        classifications.push('highly profitable');
    } else if (profitMargin >= 20) {
        classifications.push('healthy margins');
    } else if (profitMargin >= 0) {
        classifications.push('low margins');
    } else {
        classifications.push('operating at a loss');
    }

    // Market positioning
    if (pricePerCustomer >= 1000) {
        classifications.push('enterprise-focused');
    } else if (pricePerCustomer >= 200) {
        classifications.push('mid-market');
    } else {
        classifications.push('mass-market');
    }

    // Churn profile
    if (monthlyChurn <= 3) {
        classifications.push('sticky customers');
    } else if (monthlyChurn <= 7) {
        classifications.push('moderate retention');
    } else {
        classifications.push('high churn');
    }

    // Scalability assessment
    if (grossMargin >= 70 && profitMargin >= 20) {
        classifications.push('highly scalable');
    } else if (infraRatio > 0.4) {
        classifications.push('scale requires cost optimization');
    }

    return classifications;
}

// Generate investor one-liner
function buildInvestorOneLiner(metrics) {
    const { monthlyRevenue, ltv, ltvCacRatio, customers, pricePerCustomer, monthlyChurn } = metrics;
    const arr = monthlyRevenue * 12;

    let line = `We run a film-location SaaS serving ${integer.format(customers)} clients at ${money.format(pricePerCustomer)}/month, `;
    line += `generating ${money.format(arr)} ARR with `;

    if (ltv && !isNaN(ltv) && isFinite(ltv)) {
        line += `an estimated customer LTV of ${money.format(ltv)}`;
    } else {
        line += `strong customer relationships`;
    }

    if (ltvCacRatio && !isNaN(ltvCacRatio) && isFinite(ltvCacRatio) && ltvCacRatio > 0) {
        line += ` and a ${ltvCacRatio.toFixed(1)}:1 LTV:CAC ratio`;
    }

    line += `. `;

    // Add churn context
    if (monthlyChurn <= 3) {
        line += `Low churn (${monthlyChurn}%/mo) indicates strong product-market fit.`;
    } else if (monthlyChurn >= 8) {
        line += `Churn (${monthlyChurn}%/mo) represents our primary optimization opportunity.`;
    }

    return line;
}

// Get all input elements
const inputs = {
    customerSegment: document.getElementById('customerSegment'),
    pricingModel: document.getElementById('pricingModel'),
    customers: document.getElementById('customers'),
    locationsPerCustomer: document.getElementById('locationsPerCustomer'),
    imagesPerLocation: document.getElementById('imagesPerLocation'),
    avgImageSize: document.getElementById('avgImageSize'),
    monthlyViewsPerImage: document.getElementById('monthlyViewsPerImage'),
    pricingTier: document.getElementById('pricingTier'),
    pricePerCustomer: document.getElementById('pricePerCustomer'),
    setupFee: document.getElementById('setupFee'),
    projectFeeRevenue: document.getElementById('projectFeeRevenue'),
    monthlyChurn: document.getElementById('monthlyChurn'),
    monthlyGrowth: document.getElementById('monthlyGrowth'),
    useVercel: document.getElementById('useVercel'),
    vercelTeamMembers: document.getElementById('vercelTeamMembers'),
    vercelBandwidthMultiplier: document.getElementById('vercelBandwidthMultiplier'),
    employeeSalaries: document.getElementById('employeeSalaries'),
    marketingSpend: document.getElementById('marketingSpend'),
    otherMonthlyCosts: document.getElementById('otherMonthlyCosts'),
    freeUsers: document.getElementById('freeUsers'),
    conversionRate: document.getElementById('conversionRate'),
    avgConversionTime: document.getElementById('avgConversionTime'),
    costPerFreeUser: document.getElementById('costPerFreeUser')
};

// Helper function to safely set HTML content (prevents XSS)
function safeSetContent(elementId, htmlContent) {
    const element = document.getElementById(elementId);
    if (!element) return;

    // Clear existing content
    element.textContent = '';

    // Parse HTML string and create DOM elements
    const temp = document.createElement('div');
    temp.innerHTML = htmlContent;

    // Move children to target element
    while (temp.firstChild) {
        element.appendChild(temp.firstChild);
    }
}

// Add event listeners
Object.values(inputs).forEach(input => {
    input.addEventListener('input', calculate);
    input.addEventListener('change', calculate);
});

// Customer segment presets
function updateSegmentDefaults() {
    const segment = inputs.customerSegment.value;
    const presets = {
        production_company: { locations: 150, images: 25, views: 5, price: 499, churn: 3 },
        ad_agency: { locations: 300, images: 20, views: 15, price: 999, churn: 4 },
        location_scout: { locations: 500, images: 30, views: 3, price: 199, churn: 8 },
        streaming_platform: { locations: 100, images: 25, views: 8, price: 2999, churn: 2 },
        indie_filmmaker: { locations: 50, images: 20, views: 2, price: 149, churn: 10 }
    };

    if (presets[segment]) {
        inputs.locationsPerCustomer.value = presets[segment].locations;
        inputs.imagesPerLocation.value = presets[segment].images;
        inputs.monthlyViewsPerImage.value = presets[segment].views;
        inputs.pricePerCustomer.value = presets[segment].price;
        inputs.monthlyChurn.value = presets[segment].churn;

        // Update segment story
        safeSetContent('segmentStory', segmentStories[segment] || '');

        calculate();
    }
}

// Pricing tier presets
function updatePricingTier() {
    const tier = inputs.pricingTier.value;
    const freemiumSection = document.getElementById('freemiumSection');
    const starterSection = document.getElementById('starterSection');
    const freemiumMetrics = document.getElementById('freemiumMetrics');

    const tiers = {
        free: { price: 0, setup: 0, churn: 15, showFreemium: true, showStarter: false, showMetrics: true },
        starter: { price: 29, setup: 0, churn: 10, showFreemium: false, showStarter: true, showMetrics: false },
        freelancer: { price: 149, setup: 0, churn: 8, showFreemium: false, showStarter: false, showMetrics: false },
        professional: { price: 499, setup: 500, churn: 3, showFreemium: false, showStarter: false, showMetrics: false },
        studio: { price: 1499, setup: 1000, churn: 2, showFreemium: false, showStarter: false, showMetrics: false },
        enterprise: { price: 3999, setup: 5000, churn: 1, showFreemium: false, showStarter: false, showMetrics: false }
    };

    if (tiers[tier]) {
        inputs.pricePerCustomer.value = tiers[tier].price;
        inputs.setupFee.value = tiers[tier].setup;
        inputs.monthlyChurn.value = tiers[tier].churn;

        // Show/hide freemium and starter info boxes
        freemiumSection.style.display = tiers[tier].showFreemium ? 'block' : 'none';
        starterSection.style.display = tiers[tier].showStarter ? 'block' : 'none';
        freemiumMetrics.style.display = tiers[tier].showMetrics ? 'block' : 'none';

        // Note: calculate() is called by the parent function (updatePricingModel or direct caller)
    }
}

// Pricing model selector
function updatePricingModel() {
    const model = document.getElementById('pricingModel').value;
    const tieredSection = document.getElementById('tieredPricingSection');
    const usageInfo = document.getElementById('usagePricingInfo');
    const backupInfo = document.getElementById('backupStrategyInfo');

    if (model === 'tiered') {
        tieredSection.style.display = 'block';
        usageInfo.style.display = 'none';
        backupInfo.style.display = 'none';
        // Use tier pricing
        updatePricingTier();
    } else if (model === 'usage') {
        tieredSection.style.display = 'none';
        usageInfo.style.display = 'block';
        backupInfo.style.display = 'none';
        // Usage-based: $99 base + $0.08/GB storage + $0.12/GB bandwidth
        inputs.pricePerCustomer.value = 99; // Base platform fee
    } else if (model === 'hybrid') {
        tieredSection.style.display = 'block';
        usageInfo.style.display = 'block';
        backupInfo.style.display = 'none';
        // Hybrid: reduced base + usage
    } else if (model === 'backup') {
        tieredSection.style.display = 'block';
        usageInfo.style.display = 'none';
        backupInfo.style.display = 'block';
        // Backup/Archive: 50% discount on selected tier for late-market positioning
        // Keep current tier selection, will apply discount in revenue calculation
        updatePricingTier();
    }

    // Single calculate() call for all pricing model changes
    calculate();
}

function switchTab(event, tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });

    // Show selected tab
    document.getElementById(tabName).classList.add('active');
    event.currentTarget.classList.add('active');

    // Recalculate to update all tabs
    calculate();
}

function getInputs() {
    return {
        customers: parseFloat(inputs.customers.value) || 0,
        locationsPerCustomer: parseFloat(inputs.locationsPerCustomer.value) || 0,
        imagesPerLocation: parseFloat(inputs.imagesPerLocation.value) || 0,
        avgImageSize: parseFloat(inputs.avgImageSize.value) || 0,
        monthlyViewsPerImage: parseFloat(inputs.monthlyViewsPerImage.value) || 0,
        pricePerCustomer: parseFloat(inputs.pricePerCustomer.value) || 0,
        setupFee: parseFloat(inputs.setupFee.value) || 0,
        projectFeeRevenue: parseFloat(inputs.projectFeeRevenue.value) || 0,
        monthlyChurn: parseFloat(inputs.monthlyChurn.value) || 0,
        monthlyGrowth: parseFloat(inputs.monthlyGrowth.value) || 0,
        useVercel: inputs.useVercel.checked,
        vercelTeamMembers: parseFloat(inputs.vercelTeamMembers.value) || 1,
        vercelBandwidthMultiplier: parseFloat(inputs.vercelBandwidthMultiplier.value) || 0,
        employeeSalaries: parseFloat(inputs.employeeSalaries.value) || 0,
        marketingSpend: parseFloat(inputs.marketingSpend.value) || 0,
        otherMonthlyCosts: parseFloat(inputs.otherMonthlyCosts.value) || 0,
        freeUsers: parseFloat(inputs.freeUsers.value) || 0,
        conversionRate: parseFloat(inputs.conversionRate.value) || 0,
        avgConversionTime: parseFloat(inputs.avgConversionTime.value) || 0,
        costPerFreeUser: parseFloat(inputs.costPerFreeUser.value) || 0
    };
}

function calculateAllMetrics(currentInputs) {
    const {
        customers, locationsPerCustomer, imagesPerLocation, avgImageSize, monthlyViewsPerImage,
        pricePerCustomer, setupFee, projectFeeRevenue, monthlyChurn, monthlyGrowth, useVercel, vercelTeamMembers,
        vercelBandwidthMultiplier, employeeSalaries, marketingSpend, otherMonthlyCosts,
        freeUsers, conversionRate, avgConversionTime, costPerFreeUser
    } = currentInputs;

    // Calculate storage and bandwidth
    const totalLocations = customers * locationsPerCustomer;
    const totalImages = totalLocations * imagesPerLocation;
    const totalStorageGB = (totalImages * avgImageSize) / 1024;
    const totalImageBandwidthGB = (totalImages * monthlyViewsPerImage * avgImageSize) / 1024;
    const frontendBandwidthGB = totalImageBandwidthGB * vercelBandwidthMultiplier;

    // Supabase costs
    const storageOverageGB = Math.max(0, totalStorageGB - STORAGE_INCLUDED);
    const storageCost = storageOverageGB * STORAGE_COST_PER_GB;
    const egressOverageGB = Math.max(0, totalImageBandwidthGB - EGRESS_INCLUDED);
    const egressCost = egressOverageGB * EGRESS_COST_PER_GB;
    const supabaseTotalCost = SUPABASE_PRO_BASE + storageCost + egressCost;

    // Vercel costs
    const vercelBaseCost = useVercel ? (vercelTeamMembers * VERCEL_PRO_PER_SEAT) : 0;
    const vercelBandwidthOverageGB = useVercel ? Math.max(0, frontendBandwidthGB - VERCEL_BANDWIDTH_INCLUDED) : 0;
    const vercelBandwidthCost = vercelBandwidthOverageGB * VERCEL_BANDWIDTH_COST;
    const vercelTotalCost = vercelBaseCost + vercelBandwidthCost;

    // Freemium costs (AWS free tier strategy)
    const freemiumCosts = freeUsers * costPerFreeUser;
    const monthlyConversions = freeUsers * (conversionRate / 100);
    const expectedConversionRevenue = monthlyConversions * pricePerCustomer;
    const freemiumROI = freemiumCosts > 0 ? expectedConversionRevenue / freemiumCosts : 0;

    // Total costs
    const otherTotalCosts = employeeSalaries + marketingSpend + otherMonthlyCosts;
    const totalCosts = supabaseTotalCost + vercelTotalCost + otherTotalCosts + freemiumCosts;
    const fixedCosts = SUPABASE_PRO_BASE + vercelBaseCost + employeeSalaries + otherMonthlyCosts;
    const variableCosts = storageCost + egressCost + vercelBandwidthCost + marketingSpend + freemiumCosts;

    // Revenue calculations - handle different pricing models
    const pricingModel = inputs.pricingModel ? inputs.pricingModel.value : 'tiered';
    let monthlyRevenue;

    if (pricingModel === 'usage') {
        // AWS-style usage-based pricing
        // Calculate per-customer usage charges (assume equal usage if individual data not available)
        const perCustomerStorageGB = customers > 0 ? totalStorageGB / customers : 0;
        const perCustomerBandwidthGB = customers > 0 ? totalImageBandwidthGB / customers : 0;
        const usageStorageRevenue = customers * perCustomerStorageGB * USAGE_STORAGE_PER_GB;
        const usageBandwidthRevenue = customers * perCustomerBandwidthGB * USAGE_BANDWIDTH_PER_GB;
        const baseFeeRevenue = USAGE_BASE_FEE * customers;
        monthlyRevenue = baseFeeRevenue + usageStorageRevenue + usageBandwidthRevenue + projectFeeRevenue;
    } else if (pricingModel === 'hybrid') {
        // Hybrid: 50% discount on base subscription fee + usage charges for aggregate usage
        const baseRevenue = customers * pricePerCustomer * 0.5;
        const usageStorageRevenue = totalStorageGB * USAGE_STORAGE_PER_GB * 0.5;
        const usageBandwidthRevenue = totalImageBandwidthGB * USAGE_BANDWIDTH_PER_GB * 0.5;
        monthlyRevenue = baseRevenue + usageStorageRevenue + usageBandwidthRevenue + projectFeeRevenue;
    } else if (pricingModel === 'backup') {
        // Backup/Archive: IBM Cloud strategy - 50% discount positioning as "backup" to existing systems
        // Customers sync their primary system with us at half price, then we become primary over 6-12 months
        monthlyRevenue = (customers * pricePerCustomer * 0.5) + projectFeeRevenue;
    } else {
        // Tiered subscription (traditional SaaS)
        monthlyRevenue = (customers * pricePerCustomer) + projectFeeRevenue;
    }

    const netProfit = monthlyRevenue - totalCosts;
    const profitMargin = monthlyRevenue > 0 ? (netProfit / monthlyRevenue * 100) : 0;

    // Unit economics
    const costPerCustomer = customers > 0 ? totalCosts / customers : 0;
    const profitPerCustomer = customers > 0 ? netProfit / customers : 0;
    const unitEconomicsRatio = costPerCustomer > 0 ? pricePerCustomer / costPerCustomer : 0;

    // Customer lifetime calculations
    const avgCustomerLifetimeMonths = monthlyChurn > 0 ? 1 / (monthlyChurn / 100) : Infinity;
    const ltv = pricePerCustomer * avgCustomerLifetimeMonths;
    const newCustomers = customers * (monthlyGrowth / 100);
    const cac = newCustomers > 0 ? marketingSpend / newCustomers : (marketingSpend > 0 ? Infinity : 0);
    const ltvCacRatio = cac > 0 && isFinite(cac) ? ltv / cac : NaN;
    const cacPayback = profitPerCustomer > 0 && cac > 0 && isFinite(cac) ? cac / profitPerCustomer : NaN;

    // Infrastructure costs
    const infrastructureCosts = supabaseTotalCost + vercelTotalCost;
    const grossMargin = monthlyRevenue > 0 ? ((monthlyRevenue - infrastructureCosts) / monthlyRevenue * 100) : 0;

    // Break-even analysis
    const breakEvenCustomers = pricePerCustomer > 0 ? Math.ceil(totalCosts / pricePerCustomer) : 0;
    const breakEvenMRR = totalCosts;
    const monthsToBreakEven = monthlyGrowth > 0 && customers < breakEvenCustomers ?
        Math.log(breakEvenCustomers / customers) / Math.log(1 + monthlyGrowth / 100) : 0;

    return {
        ...currentInputs,
        totalLocations, totalImages, totalStorageGB, totalImageBandwidthGB, frontendBandwidthGB,
        storageOverageGB, storageCost, egressOverageGB, egressCost, supabaseTotalCost,
        vercelBaseCost, vercelBandwidthOverageGB, vercelBandwidthCost, vercelTotalCost,
        otherTotalCosts, totalCosts, fixedCosts, variableCosts,
        freemiumCosts, monthlyConversions, expectedConversionRevenue, freemiumROI,
        monthlyRevenue, netProfit, profitMargin,
        costPerCustomer, profitPerCustomer, unitEconomicsRatio,
        avgCustomerLifetimeMonths, ltv, newCustomers, cac, ltvCacRatio, cacPayback,
        infrastructureCosts, grossMargin,
        breakEvenCustomers, breakEvenMRR, monthsToBreakEven,
        freeUsers, conversionRate
    };
}

function calculate() {
    const currentInputs = getInputs();
    const metrics = calculateAllMetrics(currentInputs);

    updateCalculatorTab(metrics);
    updateAnalysisTab(metrics);
    calculateScenarios(metrics);
    updateRecommendations(metrics);
}

function updateCalculatorTab(metrics) {
    const {
        customers, locationsPerCustomer, imagesPerLocation, avgImageSize, monthlyViewsPerImage,
        pricePerCustomer, useVercel, vercelTeamMembers, vercelBandwidthMultiplier,
        employeeSalaries, marketingSpend, otherMonthlyCosts,
        totalImages, totalStorageGB, totalImageBandwidthGB, frontendBandwidthGB,
        storageOverageGB, storageCost, egressOverageGB, egressCost, supabaseTotalCost,
        vercelBaseCost, vercelBandwidthOverageGB, vercelBandwidthCost, vercelTotalCost,
        otherTotalCosts, totalCosts,
        monthlyRevenue, netProfit, profitMargin,
        costPerCustomer, profitPerCustomer, unitEconomicsRatio
    } = metrics;

    // Storage & Bandwidth
    document.getElementById('totalStorage').textContent = totalStorageGB.toFixed(2) + ' GB';
    document.getElementById('totalImages').textContent = totalImages.toLocaleString() + ' images total';
    document.getElementById('totalEgress').textContent = totalImageBandwidthGB.toFixed(2) + ' GB';
    document.getElementById('egressInfo').textContent = (totalImages * monthlyViewsPerImage).toLocaleString() + ' views/month';
    document.getElementById('vercelBandwidth').textContent = frontendBandwidthGB.toFixed(2) + ' GB';

    // Supabase costs
    document.getElementById('baseCost').textContent = SUPABASE_PRO_BASE.toFixed(2);
    document.getElementById('storageOverage').textContent = storageOverageGB.toFixed(2);
    document.getElementById('storageCost').textContent = storageCost.toFixed(2);
    document.getElementById('egressOverage').textContent = egressOverageGB.toFixed(2);
    document.getElementById('egressCost').textContent = egressCost.toFixed(2);
    document.getElementById('supabaseTotalCost').textContent = supabaseTotalCost.toFixed(2);

    // Vercel costs
    document.getElementById('vercelSeats').textContent = vercelTeamMembers;
    document.getElementById('vercelBaseCost').textContent = vercelBaseCost.toFixed(2);
    document.getElementById('vercelBandwidthOverage').textContent = vercelBandwidthOverageGB.toFixed(2);
    document.getElementById('vercelBandwidthCost').textContent = vercelBandwidthCost.toFixed(2);
    document.getElementById('vercelTotalCost').textContent = vercelTotalCost.toFixed(2);

    // Other costs
    document.getElementById('salariesDisplay').textContent = employeeSalaries.toFixed(2);
    document.getElementById('marketingDisplay').textContent = marketingSpend.toFixed(2);
    document.getElementById('otherCosts').textContent = otherMonthlyCosts.toFixed(2);
    document.getElementById('otherTotalCost').textContent = otherTotalCosts.toFixed(2);
    document.getElementById('totalCosts').textContent = totalCosts.toFixed(2);

    // Revenue
    document.getElementById('monthlyRevenue').textContent = integer.format(monthlyRevenue);
    document.getElementById('customerCount').textContent = integer.format(customers);
    document.getElementById('priceDisplay').textContent = integer.format(pricePerCustomer);

    const netProfitElement = document.getElementById('netProfit');
    netProfitElement.textContent = money.format(netProfit);
    netProfitElement.style.color = netProfit >= 0 ? '#28a745' : '#dc3545';

    document.getElementById('profitMargin').textContent = profitMargin.toFixed(1) + '%';
    document.getElementById('profitMargin').style.color = profitMargin >= 20 ? '#28a745' : profitMargin >= 0 ? '#ffc107' : '#dc3545';

    // Unit economics
    document.getElementById('revenuePerCustomer').textContent = pricePerCustomer.toFixed(2);
    document.getElementById('costPerCustomer').textContent = costPerCustomer.toFixed(2);
    document.getElementById('profitPerCustomer').textContent = profitPerCustomer.toFixed(2);
    document.getElementById('profitPerCustomerValue').style.color = profitPerCustomer >= 0 ? '#28a745' : '#dc3545';
    document.getElementById('unitEconomics').textContent = unitEconomicsRatio.toFixed(2) + 'x';

    // Margin indicator
    const marginIndicator = document.getElementById('marginIndicator');
    if (profitMargin >= 50) {
        marginIndicator.className = 'margin-indicator margin-good';
        marginIndicator.textContent = 'üéØ Excellent margin! Very healthy SaaS business.';
    } else if (profitMargin >= 20) {
        marginIndicator.className = 'margin-indicator margin-ok';
        marginIndicator.textContent = '‚úì Good margin. Room for optimization and growth.';
    } else if (profitMargin >= 0) {
        marginIndicator.className = 'margin-indicator margin-ok';
        marginIndicator.textContent = '‚ö† Low margin. Consider cost optimization or pricing increase.';
    } else {
        marginIndicator.className = 'margin-indicator margin-bad';
        marginIndicator.textContent = '‚ö† Operating at a loss! Critical: increase pricing or reduce costs.';
    }
}

function updateAnalysisTab(metrics) {
    const {
        customers, locationsPerCustomer, imagesPerLocation, avgImageSize, monthlyViewsPerImage,
        pricePerCustomer, monthlyChurn, monthlyGrowth, useVercel, vercelTeamMembers,
        vercelBandwidthMultiplier, employeeSalaries, marketingSpend, otherMonthlyCosts,
        totalStorageGB, totalImageBandwidthGB, frontendBandwidthGB,
        storageCost, egressCost, vercelBandwidthCost, supabaseTotalCost, vercelTotalCost,
        totalCosts, fixedCosts, variableCosts,
        monthlyRevenue, netProfit, grossMargin,
        ltv, cacPayback, ltvCacRatio,
        breakEvenCustomers, breakEvenMRR, monthsToBreakEven
    } = metrics;

    // 12-month projection
    let projectedCustomers = customers;
    let totalRevenue = 0;
    let totalProjectedCost = 0;
    let newCustomersTotal = 0;
    let churnedCustomersTotal = 0;

    for (let month = 1; month <= 12; month++) {
        const newCustomers = projectedCustomers * (monthlyGrowth / 100);
        const churnedCustomers = projectedCustomers * (monthlyChurn / 100);
        projectedCustomers = projectedCustomers + newCustomers - churnedCustomers;

        newCustomersTotal += newCustomers;
        churnedCustomersTotal += churnedCustomers;

        const monthRevenue = projectedCustomers * pricePerCustomer;
        const monthStorageGB = (projectedCustomers * locationsPerCustomer * imagesPerLocation * avgImageSize) / 1024;
        const monthBandwidthGB = (projectedCustomers * locationsPerCustomer * imagesPerLocation * monthlyViewsPerImage * avgImageSize) / 1024;

        const monthStorageCost = Math.max(0, monthStorageGB - STORAGE_INCLUDED) * STORAGE_COST_PER_GB;
        const monthBandwidthCost = Math.max(0, monthBandwidthGB - EGRESS_INCLUDED) * EGRESS_COST_PER_GB;
        const monthVercelBandwidthCost = useVercel ? Math.max(0, monthBandwidthGB * vercelBandwidthMultiplier - VERCEL_BANDWIDTH_INCLUDED) * VERCEL_BANDWIDTH_COST : 0;

        const monthCost = SUPABASE_PRO_BASE + monthStorageCost + monthBandwidthCost +
                        (useVercel ? vercelTeamMembers * VERCEL_PRO_PER_SEAT : 0) + monthVercelBandwidthCost +
                        employeeSalaries + marketingSpend + otherMonthlyCosts;

        totalRevenue += monthRevenue;
        totalProjectedCost += monthCost;
    }

    // Update KPIs
    document.getElementById('arr').textContent = integer.format(monthlyRevenue * 12);
    document.getElementById('ltv').textContent = integer.format(ltv);
    document.getElementById('cacPayback').textContent = !isNaN(cacPayback) ? cacPayback.toFixed(1) + ' mo' : 'N/A';
    document.getElementById('ltvCacRatio').textContent = !isNaN(ltvCacRatio) ? ltvCacRatio.toFixed(1) + ':1' : 'N/A';
    document.getElementById('grossMargin').textContent = grossMargin.toFixed(1) + '%';
    document.getElementById('burnRate').textContent = netProfit < 0 ? money.format(Math.abs(netProfit)) : '$0';

    // 12-month projection
    document.getElementById('projStartCustomers').textContent = integer.format(customers);
    document.getElementById('projEndCustomers').textContent = integer.format(projectedCustomers);
    document.getElementById('projNewCustomers').textContent = integer.format(newCustomersTotal);
    document.getElementById('projChurnedCustomers').textContent = integer.format(churnedCustomersTotal);
    document.getElementById('projRevenue').textContent = integer.format(totalRevenue);
    document.getElementById('projCosts').textContent = integer.format(totalProjectedCost);
    const projProfit = totalRevenue - totalProjectedCost;
    const projProfitElement = document.getElementById('projProfit');
    projProfitElement.textContent = money.format(projProfit);
    projProfitElement.style.color = projProfit >= 0 ? '#28a745' : '#dc3545';

    // Cost structure
    document.getElementById('fixedCosts').textContent = fixedCosts.toFixed(0);
    document.getElementById('variableCosts').textContent = variableCosts.toFixed(0);
    document.getElementById('variableCostRatio').textContent = totalCosts > 0 ? (variableCosts / totalCosts * 100).toFixed(1) + '%' : '0%';

    // Infrastructure efficiency
    const avgCostPerGBStorage = totalStorageGB > STORAGE_INCLUDED ?
        (SUPABASE_PRO_BASE * (totalStorageGB / (totalStorageGB + totalImageBandwidthGB)) + storageCost) / totalStorageGB :
        SUPABASE_PRO_BASE / STORAGE_INCLUDED;
    const avgCostPerGBBandwidth = totalImageBandwidthGB > 0 ?
        (egressCost + vercelBandwidthCost) / (totalImageBandwidthGB + frontendBandwidthGB) : 0;

    document.getElementById('costPerGBStorage').textContent = avgCostPerGBStorage.toFixed(3);
    document.getElementById('costPerGBBandwidth').textContent = avgCostPerGBBandwidth.toFixed(3);
    document.getElementById('storageUtilization').textContent = (Math.min(totalStorageGB / STORAGE_INCLUDED * 100, 100)).toFixed(1) + '%';
    document.getElementById('bandwidthUtilization').textContent = (Math.min(totalImageBandwidthGB / EGRESS_INCLUDED * 100, 100)).toFixed(1) + '%';

    // Break-even
    const breakEvenStatus = customers >= breakEvenCustomers ? 'Profitable ‚úì' : 'Below break-even';
    document.getElementById('breakEvenStatus').textContent = breakEvenStatus;
    document.getElementById('breakEvenStatus').style.color = customers >= breakEvenCustomers ? '#28a745' : '#dc3545';
    document.getElementById('breakEvenCustomers').textContent = breakEvenCustomers;
    document.getElementById('breakEvenMRR').textContent = breakEvenMRR.toFixed(0);
    document.getElementById('monthsToBreakEven').textContent =
        customers >= breakEvenCustomers ? 'Already profitable' :
        monthsToBreakEven > 0 && monthsToBreakEven < 999 ? monthsToBreakEven.toFixed(1) : 'N/A';

    // Scaling alert
    const scalingAlert = document.getElementById('scalingAlert');
    if (totalStorageGB > STORAGE_INCLUDED * 0.8) {
        scalingAlert.className = 'alert-box alert-warning';
        scalingAlert.textContent = 'Storage Alert: Approaching or exceeding included storage quota. Usage-based costs increasing.';
    } else if (totalImageBandwidthGB > EGRESS_INCLUDED * 0.8) {
        scalingAlert.className = 'alert-box alert-warning';
        scalingAlert.textContent = 'Bandwidth Alert: Approaching or exceeding included bandwidth quota. Usage-based costs increasing.';
    } else if (grossMargin < 50) {
        scalingAlert.className = 'alert-box alert-info';
        scalingAlert.textContent = 'Low gross margin detected. Consider pricing optimization for better unit economics.';
    } else {
        scalingAlert.className = 'alert-box alert-info';
        scalingAlert.textContent = 'Infrastructure costs are within normal ranges. Continue monitoring as you scale.';
    }
}

function calculateScenarios(metrics) {
    const {
        customers, locationsPerCustomer, imagesPerLocation, avgImageSize, monthlyViewsPerImage,
        pricePerCustomer, monthlyChurn, monthlyGrowth, useVercel, vercelTeamMembers,
        vercelBandwidthMultiplier, employeeSalaries, marketingSpend, otherMonthlyCosts
    } = metrics;

    // Growth scenarios (5%, 10%, 20% monthly growth)
    const scenarios = [
        { growth: monthlyGrowth * 0.5, name: '1' },
        { growth: monthlyGrowth, name: '2' },
        { growth: monthlyGrowth * 2, name: '3' }
    ];

    scenarios.forEach(scenario => {
        let projCustomers = customers;
        for (let month = 1; month <= 12; month++) {
            projCustomers = projCustomers * (1 + scenario.growth / 100) * (1 - monthlyChurn / 100);
        }

        const revenue = projCustomers * pricePerCustomer;
        const storageGB = (projCustomers * locationsPerCustomer * imagesPerLocation * avgImageSize) / 1024;
        const bandwidthGB = (projCustomers * locationsPerCustomer * imagesPerLocation * monthlyViewsPerImage * avgImageSize) / 1024;

        const storageCost = Math.max(0, storageGB - STORAGE_INCLUDED) * STORAGE_COST_PER_GB;
        const bandwidthCost = Math.max(0, bandwidthGB - EGRESS_INCLUDED) * EGRESS_COST_PER_GB;
        const vercelBWCost = useVercel ? Math.max(0, bandwidthGB * vercelBandwidthMultiplier - VERCEL_BANDWIDTH_INCLUDED) * VERCEL_BANDWIDTH_COST : 0;

        const costs = SUPABASE_PRO_BASE + storageCost + bandwidthCost +
                    (useVercel ? vercelTeamMembers * VERCEL_PRO_PER_SEAT : 0) + vercelBWCost +
                    employeeSalaries + marketingSpend + otherMonthlyCosts;

        const profit = revenue - costs;
        const margin = revenue > 0 ? (profit / revenue * 100) : 0;

        document.getElementById(`scenario${scenario.name}Customers`).textContent = Math.round(projCustomers);
        document.getElementById(`scenario${scenario.name}Revenue`).textContent = revenue.toFixed(0);
        document.getElementById(`scenario${scenario.name}Costs`).textContent = costs.toFixed(0);
        document.getElementById(`scenario${scenario.name}Profit`).textContent = '$' + profit.toFixed(0);
        document.getElementById(`scenario${scenario.name}Profit`).style.color = profit >= 0 ? '#28a745' : '#dc3545';
        document.getElementById(`scenario${scenario.name}Margin`).textContent = margin.toFixed(1) + '%';
    });

    // Pricing scenarios
    const pricingScenarios = [
        { price: 29, name: '1' },
        { price: pricePerCustomer, name: '2' },
        { price: 99, name: '3' }
    ];

    pricingScenarios.forEach(scenario => {
        const revenue = customers * scenario.price;
        const totalImages = customers * locationsPerCustomer * imagesPerLocation;
        const storageGB = (totalImages * avgImageSize) / 1024;
        const bandwidthGB = (totalImages * monthlyViewsPerImage * avgImageSize) / 1024;

        const storageCost = Math.max(0, storageGB - STORAGE_INCLUDED) * STORAGE_COST_PER_GB;
        const bandwidthCost = Math.max(0, bandwidthGB - EGRESS_INCLUDED) * EGRESS_COST_PER_GB;
        const vercelBWCost = useVercel ? Math.max(0, bandwidthGB * vercelBandwidthMultiplier - VERCEL_BANDWIDTH_INCLUDED) * VERCEL_BANDWIDTH_COST : 0;

        const costs = SUPABASE_PRO_BASE + storageCost + bandwidthCost +
                    (useVercel ? vercelTeamMembers * VERCEL_PRO_PER_SEAT : 0) + vercelBWCost +
                    employeeSalaries + marketingSpend + otherMonthlyCosts;

        const profit = revenue - costs;
        const margin = revenue > 0 ? (profit / revenue * 100) : 0;
        const breakEven = scenario.price > 0 ? Math.ceil(costs / scenario.price) : 0;

        document.getElementById(`pricing${scenario.name}Revenue`).textContent = revenue.toFixed(0);
        document.getElementById(`pricing${scenario.name}Profit`).textContent = '$' + profit.toFixed(0);
        document.getElementById(`pricing${scenario.name}Profit`).style.color = profit >= 0 ? '#28a745' : '#dc3545';
        document.getElementById(`pricing${scenario.name}Margin`).textContent = margin.toFixed(1) + '%';
        document.getElementById(`pricing${scenario.name}BreakEven`).textContent = breakEven;
    });
}

function updateRecommendations(metrics) {
    const {
        customers, pricePerCustomer, monthlyChurn, monthlyRevenue,
        totalStorageGB, totalImageBandwidthGB,
        storageCost, bandwidthCost,
        vercelTeamMembers, vercelBandwidthMultiplier,
        totalCosts, netProfit, profitMargin, grossMargin
    } = metrics;

    const vercelBWCost = metrics.vercelBandwidthCost;

    // Business classification
    const classifications = classifyBusiness(metrics);
    const classText = `A <strong>${classifications.join(', ')}</strong> business.`;
    document.getElementById('classificationText').innerHTML = classText;

    // Color the classification box based on profitability
    const classBox = document.getElementById('businessClassification');
    if (profitMargin >= 20) {
        classBox.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
    } else if (profitMargin >= 0) {
        classBox.style.background = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
    } else {
        classBox.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
    }

    // Investor one-liner
    document.getElementById('investorOneLiner').textContent = buildInvestorOneLiner(metrics);

    // Health metrics
    let healthHTML = '<div class="kpi-grid">';

    const healthMetrics = [
        {
            label: 'Profitability',
            status: profitMargin >= 20 ? 'Healthy' : profitMargin >= 0 ? 'Fair' : 'Poor',
            color: profitMargin >= 20 ? '#28a745' : profitMargin >= 0 ? '#ffc107' : '#dc3545'
        },
        {
            label: 'Gross Margin',
            status: grossMargin >= 70 ? 'Excellent' : grossMargin >= 50 ? 'Good' : 'Needs Improvement',
            color: grossMargin >= 70 ? '#28a745' : grossMargin >= 50 ? '#ffc107' : '#dc3545'
        },
        {
            label: 'Churn Rate',
            status: monthlyChurn <= 3 ? 'Excellent' : monthlyChurn <= 7 ? 'Good' : 'High',
            color: monthlyChurn <= 3 ? '#28a745' : monthlyChurn <= 7 ? '#ffc107' : '#dc3545'
        },
        {
            label: 'Unit Economics',
            status: customers > 0 && pricePerCustomer > (totalCosts / customers) * 1.5 ? 'Strong' : customers > 0 && pricePerCustomer > (totalCosts / customers) ? 'Fair' : 'Weak',
            color: customers > 0 && pricePerCustomer > (totalCosts / customers) * 1.5 ? '#28a745' : customers > 0 && pricePerCustomer > (totalCosts / customers) ? '#ffc107' : '#dc3545'
        }
    ];

    healthMetrics.forEach(metric => {
        healthHTML += `
            <div class="kpi-card">
                <div class="kpi-label">${metric.label}</div>
                <div class="kpi-value" style="color: ${metric.color}; font-size: 24px;">${metric.status}</div>
            </div>
        `;
    });
    healthHTML += '</div>';
    safeSetContent('healthMetrics', healthHTML);

    // Recommendations
    let recsHTML = '';

    if (profitMargin < 0) {
        recsHTML += `
            <div class="alert-box alert-danger">
                <strong>Critical: Operating at a Loss</strong><br>
                Your business is currently unprofitable. Consider:<br>
                ‚Ä¢ Increasing pricing by ${Math.ceil((totalCosts / (customers * pricePerCustomer) - 1) * 100 + 10)}% to reach profitability<br>
                ‚Ä¢ Reducing costs by $${Math.abs(netProfit).toFixed(0)}/month<br>
                ‚Ä¢ Acquiring ${Math.ceil(totalCosts / pricePerCustomer - customers)} more customers at current pricing
            </div>
        `;
    } else if (profitMargin < 20) {
        recsHTML += `
            <div class="alert-box alert-warning">
                <strong>Low Profit Margin</strong><br>
                Your margin of ${profitMargin.toFixed(1)}% is below healthy SaaS benchmarks (20-30%). Consider:<br>
                ‚Ä¢ Optimizing infrastructure costs<br>
                ‚Ä¢ Implementing value-based pricing tiers<br>
                ‚Ä¢ Reducing image sizes or implementing compression
            </div>
        `;
    }

    if (grossMargin < 70) {
        recsHTML += `
            <div class="alert-box alert-warning">
                <strong>Infrastructure Costs High</strong><br>
                Gross margin of ${grossMargin.toFixed(1)}% suggests infrastructure costs are eating into profits. Consider:<br>
                ‚Ä¢ Implementing image compression and lazy loading<br>
                ‚Ä¢ Using CDN caching more effectively<br>
                ‚Ä¢ Optimizing storage with archival tiers for old images
            </div>
        `;
    }

    if (monthlyChurn > 7) {
        recsHTML += `
            <div class="alert-box alert-danger">
                <strong>High Churn Rate</strong><br>
                ${monthlyChurn.toFixed(1)}% monthly churn is concerning. Focus on:<br>
                ‚Ä¢ Customer success and onboarding improvements<br>
                ‚Ä¢ Product features that increase stickiness<br>
                ‚Ä¢ Understanding why customers are leaving
            </div>
        `;
    }

    if (totalStorageGB > STORAGE_INCLUDED) {
        recsHTML += `
            <div class="alert-box alert-info">
                <strong>Storage Optimization Opportunity</strong><br>
                You're paying for ${(totalStorageGB - STORAGE_INCLUDED).toFixed(0)} GB of storage overage ($${storageCost.toFixed(0)}/mo). Consider:<br>
                ‚Ä¢ Implementing image compression (WebP format, ~30% smaller)<br>
                ‚Ä¢ Offering multiple image size options<br>
                ‚Ä¢ Archiving rarely-accessed images
            </div>
        `;
    }

    if (totalImageBandwidthGB > EGRESS_INCLUDED) {
        recsHTML += `
            <div class="alert-box alert-info">
                <strong>Bandwidth Optimization Opportunity</strong><br>
                You're paying for ${(totalImageBandwidthGB - EGRESS_INCLUDED).toFixed(0)} GB of bandwidth overage ($${bandwidthCost.toFixed(0)}/mo). Consider:<br>
                ‚Ä¢ Implementing aggressive CDN caching<br>
                ‚Ä¢ Using responsive images (serve smaller sizes on mobile)<br>
                ‚Ä¢ Lazy loading images below the fold
            </div>
        `;
    }

    if (recsHTML === '') {
        recsHTML = `
            <div class="alert-box alert-info">
                <strong>Business is Healthy!</strong><br>
                Your key metrics are in good shape. Focus on:<br>
                ‚Ä¢ Sustainable growth and customer acquisition<br>
                ‚Ä¢ Continuously improving product value<br>
                ‚Ä¢ Monitoring unit economics as you scale
            </div>
        `;
    }

    safeSetContent('recommendations-content', recsHTML);

    // Optimization opportunities
    let optHTML = '<div class="cost-breakdown">';

    if (totalStorageGB > 50) {
        const savings = storageCost * 0.3;
        optHTML += `
            <div class="breakdown-row">
                <span>Image Compression (WebP, 30% reduction)</span>
                <span style="color: #28a745;">Save ~$${savings.toFixed(0)}/mo</span>
            </div>
        `;
    }

    if (totalImageBandwidthGB > 100) {
        const savings = bandwidthCost * 0.4;
        optHTML += `
            <div class="breakdown-row">
                <span>CDN Caching + Lazy Loading (40% reduction)</span>
                <span style="color: #28a745;">Save ~$${savings.toFixed(0)}/mo</span>
            </div>
        `;
    }

    if (pricePerCustomer < 50) {
        const additionalRevenue = customers * 10;
        optHTML += `
            <div class="breakdown-row">
                <span>Price Increase to $${pricePerCustomer + 10}/mo (+$10)</span>
                <span style="color: #28a745;">+$${additionalRevenue.toFixed(0)}/mo revenue</span>
            </div>
        `;
    }

    optHTML += '</div>';
    safeSetContent('optimization-content', optHTML);

    // Risk assessment
    let riskHTML = '';

    const risks = [];
    if (profitMargin < 0) risks.push({ level: 'High', text: 'Operating at a loss with no clear path to profitability' });
    if (monthlyChurn > 10) risks.push({ level: 'High', text: 'Very high churn rate threatens business sustainability' });
    if (grossMargin < 40) risks.push({ level: 'High', text: 'Poor unit economics make scaling difficult' });
    if (monthlyChurn > 5 && monthlyChurn <= 10) risks.push({ level: 'Medium', text: 'Elevated churn rate needs attention' });
    if (totalImageBandwidthGB > EGRESS_INCLUDED * 2) risks.push({ level: 'Medium', text: 'High bandwidth costs may impact profitability at scale' });
    if (profitMargin > 0 && profitMargin < 15) risks.push({ level: 'Medium', text: 'Low margins provide little buffer for unexpected costs' });

    if (risks.length === 0) {
        riskHTML = '<div class="alert-box alert-info">No major risks identified. Continue monitoring key metrics.</div>';
    } else {
        risks.forEach(risk => {
            const alertClass = risk.level === 'High' ? 'alert-danger' : 'alert-warning';
            riskHTML += `<div class="alert-box ${alertClass}"><strong>${risk.level} Risk:</strong> ${risk.text}</div>`;
        });
    }

    safeSetContent('risk-content', riskHTML);
}

// ========================================
// GRANT APPLICATION FUNCTIONS (PROPOSE MODE)
// ========================================

// Grant program definitions
const GRANT_PROGRAMS = {
    voxtur: {
        name: 'V√∂xtur (Growth)',
        nameEn: 'V√∂xtur',
        maxGrant: 50000000, // ISK
        minOwnPercent: 25,
        maxDuration: 36,
        evaluation: { innovation: 30, impact: 40, execution: 30 },
        color: '#10b981'
    },
    sproti: {
        name: 'Sproti (Sprout)',
        nameEn: 'Sproti',
        maxGrant: 15000000,
        minOwnPercent: 10,
        maxDuration: 24,
        evaluation: { innovation: 40, impact: 30, execution: 30 },
        color: '#6366f1'
    },
    throunarfrae: {
        name: '√ûr√≥unarfr√¶ (Development Seed)',
        nameEn: '√ûr√≥unarfr√¶',
        maxGrant: 25000000,
        minOwnPercent: 40,
        maxDuration: 24,
        evaluation: { innovation: 35, impact: 35, execution: 30 },
        color: '#f59e0b'
    }
};

// Format ISK currency
function formatISK(amount) {
    return new Intl.NumberFormat('is-IS', {
        style: 'currency',
        currency: 'ISK',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(amount);
}

// Select grant program (visual feedback)
function selectGrantProgram(programId) {
    // Update dropdown
    document.getElementById('grantProgram').value = programId;

    // Update visual selection
    ['voxtur', 'sproti', 'throunarfrae'].forEach(id => {
        const elem = document.getElementById(`program-${id}`);
        if (id === programId) {
            elem.style.borderWidth = '3px';
            elem.style.boxShadow = `0 4px 12px ${GRANT_PROGRAMS[id].color}40`;
        } else {
            elem.style.borderWidth = '2px';
            elem.style.boxShadow = 'none';
        }
    });

    // Recalculate
    calculateGrant();
}

// Update grant percentage display
function updateGrantPercentage() {
    const percent = parseInt(document.getElementById('grantRequestPercent').value);
    const program = GRANT_PROGRAMS[document.getElementById('grantProgram').value];

    document.getElementById('grantPercentDisplay').textContent = `${percent}%`;

    // Warn if below minimum
    const ownPercent = 100 - percent;
    const warning = document.getElementById('grantPercentWarning');
    if (ownPercent < program.minOwnPercent) {
        warning.innerHTML = `‚ö†Ô∏è Warning: ${program.nameEn} requires min ${program.minOwnPercent}% own contribution (you have ${ownPercent}%)`;
        warning.style.color = '#dc3545';
    } else {
        warning.innerHTML = `‚úì Own contribution: ${ownPercent}% (min ${program.minOwnPercent}% required)`;
        warning.style.color = '#10b981';
    }

    calculateGrant();
}

// Calculate grant budget
function calculateGrant() {
    const inputs = gatherInputs();
    const programId = document.getElementById('grantProgram').value;
    const program = GRANT_PROGRAMS[programId];
    const projectDuration = parseInt(document.getElementById('projectDuration').value);
    const grantPercent = parseInt(document.getElementById('grantRequestPercent').value);

    // Calculate monthly costs from main calculator
    const monthlyCosts = inputs.employeeSalaries + inputs.marketingSpend + inputs.otherMonthlyCosts;
    const supabaseCost = SUPABASE_PRO_BASE + Math.max(0, (inputs.totalImageStorageGB - STORAGE_INCLUDED)) * STORAGE_COST_PER_GB +
                        Math.max(0, (inputs.totalImageBandwidthGB - EGRESS_INCLUDED)) * EGRESS_COST_PER_GB;
    const vercelCost = VERCEL_PRO_PER_SEAT + Math.max(0, (inputs.totalFrontendBandwidthGB - VERCEL_BANDWIDTH_INCLUDED)) * VERCEL_BANDWIDTH_COST_PER_GB;
    const infrastructureCost = supabaseCost + vercelCost;

    const totalMonthlyCost = monthlyCosts + infrastructureCost;
    const totalProjectCost = totalMonthlyCost * projectDuration;
    const grantAmount = totalProjectCost * (grantPercent / 100);
    const ownContribution = totalProjectCost - grantAmount;
    const ownPercent = 100 - grantPercent;

    // Check if grant exceeds maximum
    const exceedsMax = grantAmount > program.maxGrant;
    const cappedGrant = Math.min(grantAmount, program.maxGrant);

    // Generate budget summary
    let summaryHTML = `
        <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
            <h3 style="margin-bottom: 15px; color: ${program.color};">${program.name}</h3>
            <div style="display: grid; gap: 10px;">
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #d1fae5;">
                    <span>Project Duration:</span>
                    <strong>${projectDuration} months</strong>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #d1fae5;">
                    <span>Monthly Costs (avg):</span>
                    <strong>${formatISK(totalMonthlyCost)}</strong>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #d1fae5;">
                    <span>Total Project Cost:</span>
                    <strong>${formatISK(totalProjectCost)}</strong>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 12px 0; background: ${program.color}20; margin: 10px -10px; padding-left: 10px; padding-right: 10px; border-radius: 6px;">
                    <span style="font-weight: 600; color: ${program.color};">Grant Request (${grantPercent}%):</span>
                    <strong style="font-size: 18px; color: ${program.color};">${formatISK(grantAmount)}</strong>
                </div>
                ${exceedsMax ? `<div class="alert-box alert-warning" style="margin: 10px 0;">‚ö†Ô∏è Request exceeds max grant of ${formatISK(program.maxGrant)}. Will be capped.</div>` : ''}
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #d1fae5;">
                    <span>Own Contribution (${ownPercent}%):</span>
                    <strong>${formatISK(ownContribution)}</strong>
                </div>
                ${ownPercent < program.minOwnPercent ? `<div class="alert-box alert-danger" style="margin: 10px 0;">‚ùå Insufficient own contribution. Min ${program.minOwnPercent}% required.</div>` : ''}
            </div>
        </div>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-size: 13px;">
            <div style="margin-bottom: 8px;"><strong>Budget Breakdown:</strong></div>
            <div style="margin-left: 10px;">
                <div>‚Ä¢ Personnel: ${formatISK(inputs.employeeSalaries * projectDuration)}</div>
                <div>‚Ä¢ Infrastructure: ${formatISK(infrastructureCost * projectDuration)}</div>
                <div>‚Ä¢ Marketing: ${formatISK(inputs.marketingSpend * projectDuration)}</div>
                <div>‚Ä¢ Other: ${formatISK(inputs.otherMonthlyCosts * projectDuration)}</div>
            </div>
        </div>
    `;

    safeSetContent('grantBudgetSummary', summaryHTML);

    // Calculate multi-year projections
    calculateMultiYearProjections(totalMonthlyCost, projectDuration, grantAmount);
}

// Calculate multi-year projections
function calculateMultiYearProjections(monthlyCost, grantDuration, grantAmount) {
    const includePostGrant = document.getElementById('includePostGrant').checked;
    const totalYears = includePostGrant ? Math.ceil(grantDuration / 12) + 2 : Math.ceil(grantDuration / 12);

    let projectionsHTML = `
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Year</th>
                        <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">Period</th>
                        <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">Costs</th>
                        <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">Revenue</th>
                        <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">Grant Funding</th>
                        <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">Cash Flow</th>
                        <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">Cumulative</th>
                    </tr>
                </thead>
                <tbody>
    `;

    const inputs = gatherInputs();
    let cumulativeCash = 0;
    let remainingGrant = grantAmount;

    for (let year = 1; year <= totalYears; year++) {
        const isGrantYear = (year * 12) <= grantDuration;
        const monthsInYear = 12;
        const yearCosts = monthlyCost * monthsInYear;

        // Revenue projection (assuming growth from current calculator)
        const customersYear = inputs.customers * Math.pow(1 + inputs.monthlyGrowth / 100, (year - 1) * 12);
        const yearRevenue = customersYear * inputs.pricePerCustomer * monthsInYear;

        // Grant funding for this year
        const yearGrantFunding = isGrantYear ? Math.min(yearCosts, remainingGrant) : 0;
        remainingGrant = Math.max(0, remainingGrant - yearGrantFunding);

        // Cash flow
        const cashFlow = yearRevenue + yearGrantFunding - yearCosts;
        cumulativeCash += cashFlow;

        const periodLabel = isGrantYear ? 'Grant Period' : 'Post-Grant';
        const rowStyle = isGrantYear ? 'background: #f0fdf4;' : '';

        projectionsHTML += `
            <tr style="${rowStyle}">
                <td style="padding: 12px; border: 1px solid #dee2e6;"><strong>Year ${year}</strong></td>
                <td style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">${periodLabel}</td>
                <td style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">${formatISK(yearCosts)}</td>
                <td style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">${formatISK(yearRevenue)}</td>
                <td style="padding: 12px; text-align: right; border: 1px solid #dee2e6; color: #10b981; font-weight: 600;">${formatISK(yearGrantFunding)}</td>
                <td style="padding: 12px; text-align: right; border: 1px solid #dee2e6; color: ${cashFlow >= 0 ? '#10b981' : '#dc3545'}; font-weight: 600;">${formatISK(cashFlow)}</td>
                <td style="padding: 12px; text-align: right; border: 1px solid #dee2e6; font-weight: 600;">${formatISK(cumulativeCash)}</td>
            </tr>
        `;
    }

    projectionsHTML += `
                </tbody>
            </table>
        </div>

        <div class="alert-box alert-info" style="margin-top: 15px;">
            <strong>Projection Assumptions:</strong><br>
            ‚Ä¢ Customer growth rate: ${inputs.monthlyGrowth}% per month<br>
            ‚Ä¢ Price per customer: ${formatISK(inputs.pricePerCustomer)}/month<br>
            ‚Ä¢ Costs remain constant at current calculator values<br>
            ‚Ä¢ Grant funding distributed evenly over grant period
        </div>
    `;

    safeSetContent('multiYearProjections', projectionsHTML);
}

// Export grant budget to Excel (Rann√≠s format)
function exportGrantBudgetExcel() {
    const projectName = document.getElementById('projectName').value;
    const projectDuration = parseInt(document.getElementById('projectDuration').value);
    const inputs = gatherInputs();

    // Calculate costs
    const monthlyCosts = inputs.employeeSalaries + inputs.marketingSpend + inputs.otherMonthlyCosts;
    const supabaseCost = SUPABASE_PRO_BASE + Math.max(0, (inputs.totalImageStorageGB - STORAGE_INCLUDED)) * STORAGE_COST_PER_GB +
                        Math.max(0, (inputs.totalImageBandwidthGB - EGRESS_INCLUDED)) * EGRESS_COST_PER_GB;
    const vercelCost = VERCEL_PRO_PER_SEAT + Math.max(0, (inputs.totalFrontendBandwidthGB - VERCEL_BANDWIDTH_INCLUDED)) * VERCEL_BANDWIDTH_COST_PER_GB;
    const infrastructureCost = supabaseCost + vercelCost;
    const totalMonthlyCost = monthlyCosts + infrastructureCost;

    // Calculate per-year breakdown (up to 3 years)
    const years = Math.min(3, Math.ceil(projectDuration / 12));
    const year1Months = Math.min(12, projectDuration);
    const year2Months = Math.min(12, Math.max(0, projectDuration - 12));
    const year3Months = Math.max(0, projectDuration - 24);

    // Create workbook
    const wb = XLSX.utils.book_new();

    // Budget worksheet matching Rann√≠s format
    const budgetData = [
        ['Kostna√∞ar√°√¶tlun - Hj√°lparskjal'],
        [],
        ['√ûetta skjal er til a√∞ au√∞velda ums√¶kjendum a√∞ gera kostna√∞ar√°√¶tlun fyrir rafr√¶nt skr√°ningarey√∞ubla√∞ sj√≥√∞sins.'],
        ['Verkefni:', projectName],
        [],
        [],
        ['Verkefnis√°r 1', '', '', '', '', 'Verkefnis√°r 2', '', '', '', '', 'Verkefnis√°r 3'],
        ['Allar upph√¶√∞ir √≠ √æ√∫sundum kr√≥na', '', '', '', '', 'Allar upph√¶√∞ir √≠ √æ√∫sundum kr√≥na', '', '', '', '', 'Allar upph√¶√∞ir √≠ √æ√∫sundum kr√≥na'],
        [],
        ['Laun og launatengd gj√∂ld', '', '', '', '', 'Laun og launatengd gj√∂ld', '', '', '', '', 'Laun og launatengd gj√∂ld'],
        ['Heiti √æ√°tttakanda', 'Laun√æegi', 'Mannm√°nu√∞ir', 'Laun', 'Samtals', 'Heiti √æ√°tttakanda', 'Laun√æegi', 'Mannm√°nu√∞ir', 'Laun', 'Samtals', 'Heiti √æ√°tttakanda', 'Laun√æegi', 'Mannm√°nu√∞ir', 'Laun', 'Samtals'],
        [document.getElementById('companyName').value || 'Fyrirt√¶ki', 'J√°', year1Months, (inputs.employeeSalaries * year1Months / 1000).toFixed(0), (inputs.employeeSalaries * year1Months / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'J√°', year2Months, (inputs.employeeSalaries * year2Months / 1000).toFixed(0), (inputs.employeeSalaries * year2Months / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'J√°', year3Months, (inputs.employeeSalaries * year3Months / 1000).toFixed(0), (inputs.employeeSalaries * year3Months / 1000).toFixed(0)],
        ['Samtals', '', '', '', (inputs.employeeSalaries * year1Months / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.employeeSalaries * year2Months / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.employeeSalaries * year3Months / 1000).toFixed(0)],
        [],
        ['Rekstrarv√∂rur, efni o.fl.', '', '', '', '', 'Rekstrarv√∂rur, efni o.fl.', '', '', '', '', 'Rekstrarv√∂rur, efni o.fl.'],
        ['Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals'],
        [document.getElementById('companyName').value || 'Fyrirt√¶ki', 'Rekstrarv√∂rur', '', '', (inputs.otherMonthlyCosts * year1Months * 0.3 / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'Rekstrarv√∂rur', '', '', (inputs.otherMonthlyCosts * year2Months * 0.3 / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'Rekstrarv√∂rur', '', '', (inputs.otherMonthlyCosts * year3Months * 0.3 / 1000).toFixed(0)],
        ['Samtals', '', '', '', (inputs.otherMonthlyCosts * year1Months * 0.3 / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.otherMonthlyCosts * year2Months * 0.3 / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.otherMonthlyCosts * year3Months * 0.3 / 1000).toFixed(0)],
        [],
        ['A√∞keypt √æj√≥nusta', '', '', '', '', 'A√∞keypt √æj√≥nusta', '', '', '', '', 'A√∞keypt √æj√≥nusta'],
        ['Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals'],
        [document.getElementById('companyName').value || 'Fyrirt√¶ki', 'Cloud infrastructure (Supabase/Vercel)', '', '', (infrastructureCost * year1Months / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'Cloud infrastructure (Supabase/Vercel)', '', '', (infrastructureCost * year2Months / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'Cloud infrastructure (Supabase/Vercel)', '', '', (infrastructureCost * year3Months / 1000).toFixed(0)],
        ['Samtals', '', '', '', (infrastructureCost * year1Months / 1000).toFixed(0), 'Samtals', '', '', '', (infrastructureCost * year2Months / 1000).toFixed(0), 'Samtals', '', '', '', (infrastructureCost * year3Months / 1000).toFixed(0)],
        [],
        ['Fer√∞ir og fundir', '', '', '', '', 'Fer√∞ir og fundir', '', '', '', '', 'Fer√∞ir og fundir'],
        ['Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals'],
        [document.getElementById('companyName').value || 'Fyrirt√¶ki', 'R√°√∞stefnur, vi√∞bur√∞ir', '', '', (inputs.marketingSpend * year1Months * 0.2 / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'R√°√∞stefnur, vi√∞bur√∞ir', '', '', (inputs.marketingSpend * year2Months * 0.2 / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'R√°√∞stefnur, vi√∞bur√∞ir', '', '', (inputs.marketingSpend * year3Months * 0.2 / 1000).toFixed(0)],
        ['Samtals', '', '', '', (inputs.marketingSpend * year1Months * 0.2 / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.marketingSpend * year2Months * 0.2 / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.marketingSpend * year3Months * 0.2 / 1000).toFixed(0)],
        [],
        ['Afskriftir √°halda og t√¶kja', '', '', '', '', 'Afskriftir √°halda og t√¶kja', '', '', '', '', 'Afskriftir √°halda og t√¶kja'],
        ['Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals'],
        ['', '', '', '', '0', '', '', '', '', '0', '', '', '', '', '0'],
        ['Samtals', '', '', '', '0', 'Samtals', '', '', '', '0', 'Samtals', '', '', '', '0'],
        [],
        ['Samrekstur og a√∞sta√∞a', '', '', '', '', 'Samrekstur og a√∞sta√∞a', '', '', '', '', 'Samrekstur og a√∞sta√∞a'],
        ['Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals', 'Heiti √æ√°tttakanda', 'Stutt sk√Ωring', '', '', 'Samtals'],
        [document.getElementById('companyName').value || 'Fyrirt√¶ki', 'H√∫sn√¶√∞i, t√¶kjab√∫na√∞ur', '', '', (inputs.otherMonthlyCosts * year1Months * 0.7 / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'H√∫sn√¶√∞i, t√¶kjab√∫na√∞ur', '', '', (inputs.otherMonthlyCosts * year2Months * 0.7 / 1000).toFixed(0),
         document.getElementById('companyName').value || 'Fyrirt√¶ki', 'H√∫sn√¶√∞i, t√¶kjab√∫na√∞ur', '', '', (inputs.otherMonthlyCosts * year3Months * 0.7 / 1000).toFixed(0)],
        ['Samtals', '', '', '', (inputs.otherMonthlyCosts * year1Months * 0.7 / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.otherMonthlyCosts * year2Months * 0.7 / 1000).toFixed(0), 'Samtals', '', '', '', (inputs.otherMonthlyCosts * year3Months * 0.7 / 1000).toFixed(0)],
        [],
        ['Samtals kostna√∞ur', '', '', '', (totalMonthlyCost * year1Months / 1000).toFixed(0), 'Samtals kostna√∞ur', '', '', '', (totalMonthlyCost * year2Months / 1000).toFixed(0), 'Samtals kostna√∞ur', '', '', '', (totalMonthlyCost * year3Months / 1000).toFixed(0)]
    ];

    const ws = XLSX.utils.aoa_to_sheet(budgetData);

    // Set column widths
    ws['!cols'] = [
        {wch: 25}, {wch: 15}, {wch: 12}, {wch: 12}, {wch: 12},
        {wch: 25}, {wch: 15}, {wch: 12}, {wch: 12}, {wch: 12},
        {wch: 25}, {wch: 15}, {wch: 12}, {wch: 12}, {wch: 12}
    ];

    XLSX.utils.book_append_sheet(wb, ws, 'Kostna√∞ar√°√¶tlun');

    // Export file
    const filename = `Rannis_Budget_${projectName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;
    XLSX.writeFile(wb, filename);
}

// Export progress report
function exportProgressReport() {
    const projectName = document.getElementById('projectName').value;
    const companyName = document.getElementById('companyName').value || 'Fyrirt√¶ki';
    const contactPerson = document.getElementById('contactPerson').value || 'Verkefnisstj√≥ri';
    const programId = document.getElementById('grantProgram').value;
    const program = GRANT_PROGRAMS[programId];
    const reportingPeriod = document.getElementById('reportingPeriod').value;
    const actualCosts = parseFloat(document.getElementById('actualCostsToDate').value) || 0;
    const projectDuration = parseInt(document.getElementById('projectDuration').value);
    const grantPercent = parseInt(document.getElementById('grantRequestPercent').value);

    const inputs = gatherInputs();
    const totalMonthlyCost = inputs.employeeSalaries + inputs.marketingSpend + inputs.otherMonthlyCosts +
                            (SUPABASE_PRO_BASE + VERCEL_PRO_PER_SEAT);

    // Determine reporting period months
    let periodMonths;
    if (reportingPeriod === 'final') {
        periodMonths = projectDuration;
    } else {
        periodMonths = parseInt(reportingPeriod);
    }

    const projectedCosts = totalMonthlyCost * periodMonths;
    const totalProjectCost = totalMonthlyCost * projectDuration;
    const grantAmount = totalProjectCost * (grantPercent / 100);
    const grantReceived = grantAmount * 0.8; // 80% upfront typical
    const variance = actualCosts - projectedCosts;
    const variancePercent = (variance / projectedCosts * 100).toFixed(1);

    // Generate markdown report
    const report = `# FRAMVINDUSK√ùRSLA
## T√¶kni√ær√≥unarsj√≥√∞ur

---

**Verkefnisn√∫mer:** [Fylli√∞ inn]
**Heiti verkefnis:** ${projectName}
**Stu√∞n√æegi:** ${companyName}
**Verkefnisstj√≥ri:** ${contactPerson}
**Kennitala:** [Fylli√∞ inn]
**Umsj√≥narma√∞ur hj√° Rann√≠s:** [Fylli√∞ inn]

**Stu√∞ningst√≠mabil:** ${new Date().getFullYear()}
**M√°nu√∞ir:** ${reportingPeriod === 'final' ? 'Lokask√Ωrsla' : `1-${periodMonths}`}
**Stu√∞ningur T√¶kni√ær√≥unarsj√≥√∞s:** ${formatISK(grantAmount)}

---

## KOSTNA√êAR- OG FJ√ÅRM√ñGNUNARYFIRLIT

| Li√∞ur | Upph√¶√∞ (√æ√∫s.kr.) |
|-------|-----------------|
| **Kostna√∞ur alls √° t√≠mabilinu:** | ${(actualCosts / 1000).toFixed(0)} |
| **Fr√° T√¶kni√ær√≥unarsj√≥√∞i √° t√≠mabilinu:** | ${(grantReceived / 1000).toFixed(0)} |
| **√ñnnur fj√°rm√∂gnun √° t√≠mabilinu:** | ${((actualCosts - grantReceived) / 1000).toFixed(0)} |
| **Fj√°rm√∂gnun alls √° t√≠mabilinu:** | ${(actualCosts / 1000).toFixed(0)} |

**√ìsk um grei√∞slu n√∫ √∫r T√¶kni√ær√≥unarsj√≥√∞i:** ${((grantAmount * 0.2) / 1000).toFixed(0)} √æ√∫s.kr.

---

## Kostna√∞aryfirlit (√æ√∫s. kr.)

| Tegund starfsemi/raunkostna√∞ur | Verkefnisstj√≥ri | Samtals |
|-------------------------------|----------------|---------|
| **Laun og launatengd gj√∂ld:** | ${((inputs.employeeSalaries * periodMonths) / 1000).toFixed(0)} | ${((inputs.employeeSalaries * periodMonths) / 1000).toFixed(0)} |
| **Rekstrarv√∂rur:** | ${((inputs.otherMonthlyCosts * periodMonths * 0.3) / 1000).toFixed(0)} | ${((inputs.otherMonthlyCosts * periodMonths * 0.3) / 1000).toFixed(0)} |
| **A√∞keypt √æj√≥nusta:** | ${(((SUPABASE_PRO_BASE + VERCEL_PRO_PER_SEAT) * periodMonths) / 1000).toFixed(0)} | ${(((SUPABASE_PRO_BASE + VERCEL_PRO_PER_SEAT) * periodMonths) / 1000).toFixed(0)} |
| **Fer√∞ir og fer√∞akostna√∞ur:** | ${((inputs.marketingSpend * periodMonths * 0.2) / 1000).toFixed(0)} | ${((inputs.marketingSpend * periodMonths * 0.2) / 1000).toFixed(0)} |
| **Samrekstur og a√∞sta√∞a:** | ${((inputs.otherMonthlyCosts * periodMonths * 0.7) / 1000).toFixed(0)} | ${((inputs.otherMonthlyCosts * periodMonths * 0.7) / 1000).toFixed(0)} |
| **Kostna√∞ur alls:** | **${(projectedCosts / 1000).toFixed(0)}** | **${(projectedCosts / 1000).toFixed(0)}** |

### Fr√°vik fr√° √°√¶tlun

- **√Å√¶tla√∞ur kostna√∞ur:** ${formatISK(projectedCosts)}
- **Raunverulegur kostna√∞ur:** ${formatISK(actualCosts)}
- **Fr√°vik:** ${formatISK(variance)} (${variancePercent >= 0 ? '+' : ''}${variancePercent}%)
- **Sta√∞a:** ${Math.abs(parseFloat(variancePercent)) < 10 ? '‚úì Innan vi√∞mi√∞unar' : '‚ö†Ô∏è Umtalsvert fr√°vik'}

---

## FRAMVINDA √Å T√çMABILINU

### Sta√∞a verkefnisins

[L√Ωsi√∞ h√©r sk√Ωrt og hnitmi√∞a√∞ st√∂√∞u verkefnisins og framvindu mi√∞a√∞ vi√∞ verk√°√¶tlun √≠ ums√≥kn]

**Skilgreindir v√∂r√∞ur:**
- [ ] V√∂r√∞ur 1: [L√Ωsing]
- [ ] V√∂r√∞ur 2: [L√Ωsing]
- [ ] V√∂r√∞ur 3: [L√Ωsing]

### Afrakstur

[L√Ωsi√∞ √æeim afrakstri sem √°√¶tla√∞ var a√∞ skila samkv√¶mt samningi samhli√∞a framvindusk√Ωrslu]

**Afhentur afrakstur:**
1. [Afrakstur 1]
2. [Afrakstur 2]
3. [Afrakstur 3]

---

## N√ÜSTU VERK√û√ÜTTIR

[Hva√∞a verk√æ√°ttum √° a√∞ vinna a√∞ fram a√∞ n√¶stu sk√Ωrslu til sj√≥√∞sins]

**√Å√¶tla√∞ir verk√æ√¶ttir:**
1. [Verk√æ√°ttur 1]
2. [Verk√æ√°ttur 2]
3. [Verk√æ√°ttur 3]

### Breytingar √° √°√¶tlun

${Math.abs(parseFloat(variancePercent)) > 15 ? '‚ö†Ô∏è Athugi√∞: Umtalsver√∞ar breytingar √° kostna√∞ar√°√¶tlun. Vinsamlegast √∫tsk√Ωri√∞ √°st√¶√∞ur h√©r fyrir ne√∞an.' : '‚úì Engar verulegar breytingar √° √°√¶tlun.'}

[Ef verulegar breytingar hafa or√∞i√∞ √° markmi√∞i, verk√°√¶tlun, skipulagningu, stj√≥rnun og kostna√∞i verkefnisins mi√∞a√∞ vi√∞ samning, skal greina fr√° √æeim og r√∂ksty√∞ja]

---

## Undirskrift

**Sta√∞ur:** ___________________________
**Dagsetning:** ___________________________
**Verkefnisstj√≥ri:** ___________________________

---

*Skjal √∫tb√∫i√∞ me√∞ Film Location Platform Business Calculator*
*√ötb√∫i√∞: ${new Date().toLocaleString('is-IS')}*
`;

    // Download as markdown
    const blob = new Blob([report], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Framvinduskyrsla_${projectName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.md`;
    a.click();
    URL.revokeObjectURL(url);

    // Update progress tracking summary
    let summaryHTML = `
        <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px;">
            <h3 style="margin-bottom: 15px;">Progress Report Summary</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <div style="font-size: 13px; color: #6c757d; margin-bottom: 5px;">Projected Costs</div>
                    <div style="font-size: 20px; font-weight: 600;">${formatISK(projectedCosts)}</div>
                </div>
                <div>
                    <div style="font-size: 13px; color: #6c757d; margin-bottom: 5px;">Actual Costs</div>
                    <div style="font-size: 20px; font-weight: 600;">${formatISK(actualCosts)}</div>
                </div>
                <div>
                    <div style="font-size: 13px; color: #6c757d; margin-bottom: 5px;">Variance</div>
                    <div style="font-size: 20px; font-weight: 600; color: ${variance >= 0 ? '#dc3545' : '#10b981'};">${formatISK(variance)}</div>
                </div>
                <div>
                    <div style="font-size: 13px; color: #6c757d; margin-bottom: 5px;">Variance %</div>
                    <div style="font-size: 20px; font-weight: 600; color: ${Math.abs(parseFloat(variancePercent)) > 10 ? '#dc3545' : '#10b981'};">${variancePercent >= 0 ? '+' : ''}${variancePercent}%</div>
                </div>
            </div>
            <div class="alert-box alert-info" style="margin-top: 15px;">
                ‚úì Progress report downloaded successfully. Complete the narrative sections and submit to Rann√≠s.
            </div>
        </div>
    `;
    safeSetContent('progressTrackingSummary', summaryHTML);
}

// Export application as markdown
function exportApplicationPDF() {
    const projectName = document.getElementById('projectName').value;
    const companyName = document.getElementById('companyName').value || 'Fyrirt√¶ki';
    const contactPerson = document.getElementById('contactPerson').value || 'Verkefnisstj√≥ri';
    const programId = document.getElementById('grantProgram').value;
    const program = GRANT_PROGRAMS[programId];
    const projectDuration = parseInt(document.getElementById('projectDuration').value);
    const grantPercent = parseInt(document.getElementById('grantRequestPercent').value);

    const inputs = gatherInputs();
    const totalMonthlyCost = inputs.employeeSalaries + inputs.marketingSpend + inputs.otherMonthlyCosts +
                            (SUPABASE_PRO_BASE + VERCEL_PRO_PER_SEAT);
    const totalProjectCost = totalMonthlyCost * projectDuration;
    const grantAmount = totalProjectCost * (grantPercent / 100);

    const application = `# ${program.name} - Ums√≥kn
## ${projectName}

---

**Ums√¶kjandi:** ${companyName}
**Verkefnisstj√≥ri:** ${contactPerson}
**Umbe√∞in styrkupph√¶√∞:** ${formatISK(grantAmount)}
**Heildarkostna√∞ur verkefnis:** ${formatISK(totalProjectCost)}
**Eigi√∞ framlag:** ${formatISK(totalProjectCost - grantAmount)} (${100 - grantPercent}%)
**Verkefnist√≠mi:** ${projectDuration} m√°nu√∞ir

---

## 1. Markmi√∞ verkefnisins

### 1.1. L√Ωsing √° verkefninu

Film Location Database Platform er B2B SaaS vettvangur fyrir kvikmynda- og sj√≥nvarpsi√∞na√∞inn. Vettvangurinn gerir framlei√∞slufyrirt√¶kjum, augl√Ωsingastofum og sta√∞setningarleiturum kleift a√∞:

- Geyma og skipuleggja umfangsmikil gagnagrunn sta√∞setninga me√∞ h√°skerpu myndum
- Kynna og s√Ωna kvikmyndat√∂kusta√∞i fyrir framlei√∞slufyrirt√¶ki og skapandi teymi
- Gera lausam√∂nnum og sj√°lfst√¶√∞um kvikmyndager√∞arm√∂nnum kleift a√∞ n√°lgast √∫rval sta√∞setningasafna
- Au√∞velda sta√∞setningarleit me√∞ leitarh√¶fum l√Ωsig√∂gnum, leyfum og flutningauppl√Ωsingum

### 1.2. N√Ωn√¶mi

**Marka√∞slegt n√Ωn√¶mi:**
- M√¶tir n√Ωrri √æ√∂rf √° kvikmyndai√∞na√∞armarka√∞i fyrir heildarsk√Ωjalausn
- Fyrsti vettvangurinn hanna√∞ur s√©rstaklega fyrir umfangsmikillar myndas√∂fn kvikmyndager√∞ar

**T√¶knilegt n√Ωn√¶mi:**
- Hagn√Ωtir Supabase og Vercel t√¶kni √° n√Ωst√°rlegan h√°tt fyrir mynda-√æunga verkefni
- Lei√∞ir til umb√≥ta √° √æekktri sk√Ωjat√¶kni me√∞ s√©rh√¶f√∞um myndavinnslu

### 1.3. V√¶nt √°hrif

**Marka√∞sm√∂guleikar:**
- Nor√∞url√∂ndin: ~200 framlei√∞slufyrirt√¶ki √ó ‚Ç¨${((inputs.pricePerCustomer * 12) / 150).toFixed(0)}/√°r
- Evr√≥pa: ~5.000 framlei√∞slufyrirt√¶ki
- Heimsmarka√∞ur: ~50.000+ hugsanlegir vi√∞skiptavinir

**Vaxtarsp√°:**
- √År 1: ${inputs.customers} vi√∞skiptavinir, ${formatISK(inputs.pricePerCustomer * inputs.customers * 12)} velta
- √År 2: ${Math.round(inputs.customers * Math.pow(1 + inputs.monthlyGrowth/100, 12))} vi√∞skiptavinir
- √År 3: ${Math.round(inputs.customers * Math.pow(1 + inputs.monthlyGrowth/100, 24))} vi√∞skiptavinir

---

## 2. Verk√°√¶tlun

### Verk√æ√¶ttir

**M√°nu√∞ir 1-6:** Grunn√ær√≥un
- Kerfi fyrir innskr√°ningu og au√∞kenningu
- Gagnagrunnsh√∂nnun fyrir sta√∞setningar og myndir
- Grunnvi√∞m√≥t fyrir innsendingu mynda

**M√°nu√∞ir 7-12:** √çtarefni
- √ûr√≥un leitarkerfi
- S√©rsni√∞in galler√≠ og kynningars√≠√∞ur
- Vi√∞m√≥t fyrir vi√∞skiptavini (dashboard)

**M√°nu√∞ir 13-${projectDuration}:** St√¶kkun og marka√∞ssetning
- Sam√æ√¶tting vi√∞ grei√∞slumi√∞lun
- Pr√≥fanir me√∞ raunverulegum notendum
- Marka√∞sherfer√∞ √° kvikmyndah√°t√≠√∞um

### Mannafli

- Verkefnisstj√≥ri (${(inputs.employeeSalaries / 1000000).toFixed(1)}M ISK/m√°n)
- T√¶kniteymi
- Vi√∞skipta√ær√≥un og sala

---

## 3. Kostna√∞ar√°√¶tlun

| Kostna√∞arli√∞ur | M√°nu√∞ur | ${projectDuration} m√°nu√∞ir | Hlutfall |
|---------------|---------|-----------|----------|
| **Laun og launatengd gj√∂ld** | ${formatISK(inputs.employeeSalaries)} | ${formatISK(inputs.employeeSalaries * projectDuration)} | ${((inputs.employeeSalaries / totalMonthlyCost) * 100).toFixed(0)}% |
| **Innvi√∞ir (Supabase/Vercel)** | ${formatISK(SUPABASE_PRO_BASE + VERCEL_PRO_PER_SEAT)} | ${formatISK((SUPABASE_PRO_BASE + VERCEL_PRO_PER_SEAT) * projectDuration)} | ${(((SUPABASE_PRO_BASE + VERCEL_PRO_PER_SEAT) / totalMonthlyCost) * 100).toFixed(0)}% |
| **Marka√∞ssetning** | ${formatISK(inputs.marketingSpend)} | ${formatISK(inputs.marketingSpend * projectDuration)} | ${((inputs.marketingSpend / totalMonthlyCost) * 100).toFixed(0)}% |
| **Annar rekstrarkostna√∞ur** | ${formatISK(inputs.otherMonthlyCosts)} | ${formatISK(inputs.otherMonthlyCosts * projectDuration)} | ${((inputs.otherMonthlyCosts / totalMonthlyCost) * 100).toFixed(0)}% |
| **SAMTALS** | **${formatISK(totalMonthlyCost)}** | **${formatISK(totalProjectCost)}** | **100%** |

### Fj√°rm√∂gnun

- **Umbe√∞inn styrkur (${grantPercent}%):** ${formatISK(grantAmount)}
- **Eigi√∞ framlag (${100-grantPercent}%):** ${formatISK(totalProjectCost - grantAmount)}

---

## 4. Matsvi√∞mi√∞

### ${program.name} - V√¶gi matsgilda

| Matsgildi | V√¶gi |
|-----------|------|
| N√Ωn√¶mi | ${program.evaluation.innovation}% |
| √Åhrif | ${program.evaluation.impact}% |
| Framkv√¶md | ${program.evaluation.execution}% |

### Eigin mat

**N√Ωn√¶mi (${program.evaluation.innovation}%):**
- Marka√∞slegt: M√¶tir n√Ωrri √æ√∂rf √° √æekktum marka√∞i
- T√¶knilegt: T√¶kniyfirf√¶rsla me√∞ umb√≥tum

**√Åhrif (${program.evaluation.impact}%):**
- Ver√∞m√¶ti: Talsver√∞ar veltuv√°n v√¶ntingar
- L√≠kur √° √°rangri: G√≥√∞ar l√≠kur - forsendur til sta√∞ar

**Framkv√¶md (${program.evaluation.execution}%):**
- √Å√¶tlun: Raunh√¶f verk-, t√≠ma- og kostna√∞ar√°√¶tlun
- Bolmagn: A√∞ mestu leyti til sta√∞ar

---

## 5. Hagn√Ωting ni√∞ursta√∞na

### Vi√∞skiptam√≥del

- B2B SaaS √°skriftarl√≠kan
- √ûrepaskipt ver√∞lagning (‚Ç¨149-‚Ç¨3.999/m√°n)
- Markh√≥par: Framlei√∞slufyrirt√¶ki, augl√Ωsingastofur, sta√∞setningarleitar

### Marka√∞sa√∞gangur

1. **Nor√∞url√∂nd fyrst:** √çslensk, norsk, s√¶nsk kvikmyndai√∞na√∞ur
2. **Evr√≥psk √∫tv√≠kkun:** √û√Ωskaland, Bretland, Frakkland
3. **Heimsmarka√∞ur:** Bandar√≠kin, Kanada, √Åstral√≠a

### Samkeppnisforskot

- Kvikmyndai√∞na√∞ars√©rt√¶kir eiginleikar (leyfisuppl√Ωsingar, √°rst√≠√∞abundin g√∂gn)
- Stu√∞ningur vi√∞ h√°skerpu myndir (4-10MB per mynd)
- B2B √°hersla me√∞ √°rlegum samningum (l√≠til brottf√∂r)

---

**Ums√≥kn √∫tb√∫in me√∞ Film Location Platform Business Calculator**
**Dagsetning:** ${new Date().toLocaleDateString('is-IS')}
`;

    // Download as markdown
    const blob = new Blob([application], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Umsokn_${program.nameEn}_${projectName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.md`;
    a.click();
    URL.revokeObjectURL(url);
}

// ========================================
// END GRANT APPLICATION FUNCTIONS
// ========================================

// Initial calculation
calculate();
    </script>
</body>
</html>